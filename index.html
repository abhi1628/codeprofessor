<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeProfessor ‚Äî Learn to Code, One Line at a Time</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/nord.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/comment/comment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/fold/indent-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/anyword-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/searchcursor.min.js"></script>

<!-- Skulpt: instant Python in browser (no download needed) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/1.2.0/skulpt.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/skulpt/1.2.0/skulpt-stdlib.js"></script>

<style>
:root {
  --bg:#0c0e14; --bg2:#13161f; --bg3:#1a1e2b; --bg4:#222737; --bg5:#2c3347;
  --accent:#e05c5c; --blue:#5b8dee; --green:#4ecb71; --yellow:#f0b429;
  --purple:#a78bfa; --cyan:#22d3ee;
  --text:#dde1ec; --text2:#9aa3bb;
  --border:rgba(255,255,255,0.07); --border2:rgba(255,255,255,0.13);
  --font-ui:'Plus Jakarta Sans',sans-serif;
  --font-code:'JetBrains Mono',monospace;
}
body.light-mode {
  --bg:#f5f7ff; --bg2:#edf0fb; --bg3:#e2e7f8; --bg4:#d3daf5;
  --text:#1a1f35; --text2:#4a5370;
  --border:rgba(0,0,0,0.08); --border2:rgba(0,0,0,0.15);
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{font-family:var(--font-ui);background:var(--bg);color:var(--text);line-height:1.5;}

/* ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ */
#landing{
  position:fixed;inset:0;z-index:500;background:var(--bg);
  overflow-y:auto;transition:opacity 0.4s,transform 0.4s;
}
#landing.hide{opacity:0;transform:scale(0.96);pointer-events:none;}

.lnav{
  display:flex;align-items:center;justify-content:space-between;
  padding:1rem 2.5rem;border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:10;
  background:rgba(12,14,20,0.93);backdrop-filter:blur(16px);
}
.llogo{font-size:1.15rem;font-weight:900;color:var(--accent);letter-spacing:-0.5px;}
.llogo span{color:var(--text);}
.lnav-links{display:flex;gap:2rem;}
.lnav-links a{color:var(--text2);text-decoration:none;font-size:0.83rem;font-weight:600;transition:color 0.2s;}
.lnav-links a:hover{color:var(--text);}
.lnav-cta{
  background:var(--accent);color:#fff;border:none;
  padding:0.5rem 1.3rem;border-radius:6px;
  font-family:var(--font-ui);font-weight:800;font-size:0.83rem;
  cursor:pointer;transition:all 0.2s;
}
.lnav-cta:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(224,92,92,0.4);}

/* HERO */
.lhero{
  min-height:88vh;display:flex;align-items:center;justify-content:center;
  flex-direction:column;text-align:center;padding:3rem 2rem;position:relative;overflow:hidden;
}
.lhero-bg{
  position:absolute;inset:0;
  background:
    radial-gradient(ellipse 60% 50% at 20% 40%,rgba(91,141,238,0.07) 0%,transparent 60%),
    radial-gradient(ellipse 50% 40% at 80% 60%,rgba(224,92,92,0.07) 0%,transparent 60%),
    radial-gradient(ellipse 40% 30% at 50% 80%,rgba(78,203,113,0.05) 0%,transparent 50%);
}
.lhero-grid{
  position:absolute;inset:0;
  background-image:linear-gradient(rgba(91,141,238,0.03) 1px,transparent 1px),
    linear-gradient(90deg,rgba(91,141,238,0.03) 1px,transparent 1px);
  background-size:50px 50px;
  mask-image:radial-gradient(ellipse 70% 70% at 50% 50%,black,transparent);
}
.lhero-inner{position:relative;z-index:2;max-width:780px;}
.ltag{
  display:inline-flex;align-items:center;gap:0.45rem;
  background:rgba(91,141,238,0.1);border:1px solid rgba(91,141,238,0.25);
  padding:0.3rem 0.9rem;border-radius:100px;
  font-size:0.7rem;font-weight:700;color:var(--blue);
  text-transform:uppercase;letter-spacing:0.1em;margin-bottom:1.75rem;
}
.ltag-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}
.lh1{
  font-size:clamp(2.5rem,5.5vw,4.5rem);font-weight:900;
  line-height:1.08;margin-bottom:1.25rem;letter-spacing:-1.5px;
}
.lh1 .red{color:var(--accent);}
.lh1 .blue{color:var(--blue);}
.ldesc{font-size:1.05rem;color:var(--text2);max-width:540px;margin:0 auto 2.25rem;line-height:1.75;}
.lbtns{display:flex;gap:0.9rem;justify-content:center;flex-wrap:wrap;}
.lbtn-p{
  display:inline-flex;align-items:center;gap:0.45rem;
  background:var(--accent);color:#fff;
  padding:0.8rem 1.9rem;border-radius:8px;
  font-weight:800;font-size:0.92rem;
  border:none;cursor:pointer;font-family:var(--font-ui);
  transition:all 0.2s;box-shadow:0 0 35px rgba(224,92,92,0.22);
}
.lbtn-p:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(224,92,92,0.4);}
.lbtn-s{
  display:inline-flex;align-items:center;gap:0.45rem;
  background:var(--bg3);color:var(--text);
  padding:0.8rem 1.9rem;border-radius:8px;
  font-weight:700;font-size:0.92rem;
  border:1px solid var(--border2);cursor:pointer;font-family:var(--font-ui);
  transition:all 0.2s;
}
.lbtn-s:hover{background:var(--bg4);}

/* STATS */
.lstats{
  display:flex;justify-content:center;
  border-top:1px solid var(--border);border-bottom:1px solid var(--border);
  background:var(--bg2);flex-wrap:wrap;
}
.lstat{
  padding:1.4rem 2.5rem;text-align:center;
  border-right:1px solid var(--border);
}
.lstat:last-child{border-right:none;}
.lstat-n{font-size:1.7rem;font-weight:900;color:var(--blue);font-family:var(--font-code);}
.lstat-l{font-size:0.72rem;color:var(--text2);text-transform:uppercase;letter-spacing:0.08em;margin-top:0.2rem;}

/* FEATURES */
.lsec{padding:4.5rem 2.5rem;max-width:1160px;margin:0 auto;}
.lsec-tag{font-size:0.7rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--blue);margin-bottom:0.6rem;}
.lsec-title{font-size:clamp(1.7rem,3vw,2.4rem);font-weight:900;letter-spacing:-0.5px;margin-bottom:0.8rem;}
.lsec-sub{color:var(--text2);font-size:0.95rem;max-width:480px;margin-bottom:2.5rem;line-height:1.7;}
.lfeat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.1rem;}
.lfeat{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:11px;padding:1.5rem;transition:all 0.25s;
  position:relative;overflow:hidden;
}
.lfeat::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:var(--fc,var(--blue));transform:scaleX(0);
  transition:transform 0.3s;transform-origin:left;
}
.lfeat:hover::before{transform:scaleX(1);}
.lfeat:hover{border-color:var(--border2);transform:translateY(-3px);box-shadow:0 16px 40px rgba(0,0,0,0.25);}
.lfeat-icon{font-size:1.8rem;margin-bottom:0.85rem;display:block;}
.lfeat h3{font-size:0.95rem;font-weight:800;margin-bottom:0.4rem;}
.lfeat p{font-size:0.8rem;color:var(--text2);line-height:1.65;}

/* LANGS */
.llang-strip{
  background:var(--bg2);border-top:1px solid var(--border);
  border-bottom:1px solid var(--border);padding:3.5rem 2.5rem;
}
.llang-inner{max-width:1160px;margin:0 auto;}
.llang-cards{display:flex;gap:1rem;flex-wrap:wrap;margin-top:2rem;}
.llang-card{
  flex:1;min-width:190px;background:var(--bg3);border:1px solid var(--border);
  border-radius:10px;padding:1.2rem;display:flex;align-items:center;gap:0.85rem;
  transition:all 0.2s;cursor:pointer;
}
.llang-card:hover{border-color:var(--border2);transform:translateY(-3px);}
.llang-icon{
  width:42px;height:42px;border-radius:9px;
  display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0;
}
.llang-card h4{font-size:0.88rem;font-weight:800;}
.llang-card p{font-size:0.72rem;color:var(--text2);margin-top:0.15rem;}
.llang-badge{
  font-size:0.6rem;font-weight:800;text-transform:uppercase;
  padding:0.1rem 0.4rem;border-radius:3px;margin-top:0.3rem;display:inline-block;
}
.llang-badge.live{background:rgba(78,203,113,0.15);color:var(--green);}
.llang-badge.syn{background:rgba(91,141,238,0.15);color:var(--blue);}

/* FOOTER */
.lfooter{
  background:var(--bg2);border-top:1px solid var(--border);
  padding:1.75rem 2.5rem;
  display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;
}
.lfooter-logo{font-weight:900;color:var(--accent);font-size:1rem;}
.lfooter-logo span{color:var(--text2);}
.lfooter-txt{font-size:0.75rem;color:var(--text2);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IDE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#ide{
  display:flex;flex-direction:column;height:100vh;
  opacity:0;pointer-events:none;transition:opacity 0.35s;
}
#ide.show{opacity:1;pointer-events:all;}

/* TOPBAR */
.tb{
  height:50px;background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 0.65rem;gap:0.4rem;
  z-index:50;flex-shrink:0;
}
.tb-logo{
  font-weight:900;font-size:0.92rem;color:var(--accent);
  white-space:nowrap;padding:0 0.4rem;cursor:pointer;
}
.tb-logo span{color:var(--text);}
.tb-div{width:1px;height:18px;background:var(--border);flex-shrink:0;margin:0 0.2rem;}

.ltabs{display:flex;gap:0.2rem;}
.ltab{
  display:flex;align-items:center;gap:0.35rem;
  padding:0.28rem 0.7rem;border-radius:5px;
  border:1px solid transparent;background:none;
  color:var(--text2);font-family:var(--font-ui);
  font-size:0.76rem;font-weight:700;cursor:pointer;transition:all 0.12s;
}
.ltab:hover{background:var(--bg3);}
.ltab.active{background:var(--bg3);border-color:var(--border);color:var(--text);}
.ldot{width:7px;height:7px;border-radius:50%;}

.tb-right{margin-left:auto;display:flex;align-items:center;gap:0.35rem;}

/* Icon button */
.ib{
  width:30px;height:30px;border-radius:5px;
  border:1px solid var(--border);background:none;
  color:var(--text2);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  font-size:0.82rem;transition:all 0.12s;position:relative;
}
.ib:hover{background:var(--bg3);color:var(--text);}
.ib[title]:hover::after{
  content:attr(title);
  position:absolute;top:calc(100% + 5px);right:0;
  background:var(--bg4);border:1px solid var(--border);
  color:var(--text);font-size:0.65rem;font-family:var(--font-ui);
  white-space:nowrap;padding:0.25rem 0.55rem;border-radius:4px;z-index:200;pointer-events:none;
}

.run-btn{
  display:flex;align-items:center;gap:0.4rem;
  padding:0.36rem 0.95rem;border-radius:6px;border:none;
  background:var(--green);color:#0c0e14;
  font-family:var(--font-ui);font-weight:800;font-size:0.78rem;
  cursor:pointer;transition:all 0.15s;white-space:nowrap;
}
.run-btn:hover{box-shadow:0 0 20px rgba(78,203,113,0.35);transform:translateY(-1px);}
.run-btn.busy{background:var(--yellow);cursor:wait;}
.kbd{
  background:rgba(0,0,0,0.25);border-radius:3px;
  padding:0.04rem 0.3rem;font-family:var(--font-code);font-size:0.58rem;
}

.fsz-ctrl{display:flex;align-items:center;gap:0.25rem;}
.fsz-btn{
  width:23px;height:23px;border-radius:4px;border:1px solid var(--border);
  background:none;color:var(--text2);cursor:pointer;font-size:0.72rem;
  display:flex;align-items:center;justify-content:center;transition:all 0.12s;
}
.fsz-btn:hover{background:var(--bg3);color:var(--text);}
#fszDisplay{font-size:0.68rem;color:var(--text2);min-width:22px;text-align:center;font-family:var(--font-code);}

.theme-sel{
  background:var(--bg3);border:1px solid var(--border);color:var(--text);
  font-family:var(--font-ui);font-size:0.73rem;padding:0.28rem 0.5rem;
  border-radius:5px;cursor:pointer;outline:none;
}
.pts-chip{
  display:flex;align-items:center;gap:0.25rem;
  font-family:var(--font-code);font-size:0.72rem;font-weight:700;color:var(--yellow);
  padding:0.22rem 0.55rem;border-radius:20px;
  background:rgba(240,180,41,0.1);border:1px solid rgba(240,180,41,0.2);
}

/* PYODIDE LOADER */
#pyLoader{
  position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);
  background:var(--bg3);border:1px solid var(--border2);
  border-radius:8px;padding:0.6rem 1.2rem;
  display:flex;align-items:center;gap:0.6rem;
  font-size:0.78rem;font-weight:600;z-index:400;
  box-shadow:0 8px 30px rgba(0,0,0,0.4);
  transition:opacity 0.3s;
}
#pyLoader.hide{opacity:0;pointer-events:none;}
.loader-spin{
  width:14px;height:14px;border-radius:50%;
  border:2px solid var(--bg5);border-top-color:var(--green);
  animation:spin 0.7s linear infinite;flex-shrink:0;
}
@keyframes spin{to{transform:rotate(360deg);}}

/* MAIN */
.ide-main{display:flex;flex:1;overflow:hidden;min-height:0;}

/* SIDEBAR */
.sidebar{
  width:255px;background:var(--bg2);border-right:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;
  overflow:hidden;transition:width 0.25s;
}
.sidebar.off{width:0;}
.stabs{display:flex;border-bottom:1px solid var(--border);flex-shrink:0;}
.stab{
  flex:1;padding:0.6rem 0;text-align:center;
  font-size:0.62rem;font-weight:800;text-transform:uppercase;
  letter-spacing:0.06em;color:var(--text2);cursor:pointer;
  border-bottom:2px solid transparent;transition:all 0.12s;overflow:hidden;
}
.stab.active{color:var(--blue);border-bottom-color:var(--blue);}
.stab:hover{color:var(--text);}

.spanel{display:none;flex:1;overflow-y:auto;flex-direction:column;}
.spanel.active{display:flex;}
.spanel::-webkit-scrollbar{width:3px;}
.spanel::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}

/* Tutorials */
.tsearch{padding:0.55rem;border-bottom:1px solid var(--border);}
.tsearch input{
  width:100%;background:var(--bg3);border:1px solid var(--border);
  color:var(--text);font-family:var(--font-ui);font-size:0.76rem;
  padding:0.42rem 0.7rem;border-radius:6px;outline:none;transition:border-color 0.2s;
}
.tsearch input:focus{border-color:var(--blue);}
.tsearch input::placeholder{color:var(--text2);}
.tlist{padding:0.45rem;}
.tgrp-hd{
  font-size:0.6rem;font-weight:800;text-transform:uppercase;
  letter-spacing:0.1em;color:var(--text2);padding:0.55rem 0.45rem 0.2rem;
}
.titem{
  display:flex;align-items:center;gap:0.45rem;
  padding:0.48rem 0.55rem;border-radius:6px;cursor:pointer;
  transition:all 0.12s;border:1px solid transparent;margin-bottom:2px;
}
.titem:hover{background:var(--bg3);}
.titem.active{background:var(--bg3);border-color:var(--border);}
.tbadge{font-size:0.53rem;font-weight:800;text-transform:uppercase;padding:0.1rem 0.32rem;border-radius:3px;flex-shrink:0;}
.tbadge.e{background:rgba(78,203,113,0.15);color:var(--green);}
.tbadge.m{background:rgba(240,180,41,0.15);color:var(--yellow);}
.tbadge.h{background:rgba(224,92,92,0.15);color:var(--accent);}
.ttitle{font-size:0.76rem;font-weight:600;line-height:1.3;flex:1;}
.tdone{font-size:0.68rem;color:var(--green);flex-shrink:0;}
.tprog{
  padding:0.7rem;border-top:1px solid var(--border);
  font-size:0.7rem;color:var(--text2);flex-shrink:0;
}
.progbar{height:3px;background:var(--bg4);border-radius:3px;margin-top:0.3rem;overflow:hidden;}
.progfill{height:100%;background:var(--green);border-radius:3px;transition:width 0.5s;}

/* Challenges */
.clist{padding:0.45rem;display:flex;flex-direction:column;gap:0.35rem;}
.citem{
  background:var(--bg3);border:1px solid var(--border);
  border-radius:7px;padding:0.8rem;cursor:pointer;transition:all 0.15s;
}
.citem:hover{border-color:var(--border2);transform:translateX(2px);}
.citem.solved{border-color:rgba(78,203,113,0.3);}
.citem-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.35rem;}
.ctitle{font-size:0.8rem;font-weight:700;line-height:1.3;}
.ctags{display:flex;gap:0.25rem;flex-wrap:wrap;margin-top:0.3rem;}
.ctag{font-size:0.58rem;font-weight:700;padding:0.08rem 0.38rem;border-radius:3px;background:rgba(91,141,238,0.13);color:var(--blue);}
.cpts{font-size:0.68rem;color:var(--yellow);font-weight:700;}

/* Notes */
.notes-wrap{flex:1;padding:0.65rem;display:flex;flex-direction:column;gap:0.4rem;}
.notes-ta{
  flex:1;background:var(--bg3);border:1px solid var(--border);
  color:var(--text);font-family:var(--font-ui);font-size:0.8rem;
  padding:0.7rem;border-radius:7px;resize:none;outline:none;line-height:1.7;
  transition:border-color 0.2s;
}
.notes-ta:focus{border-color:var(--blue);}
.notes-save{
  background:var(--blue);color:#fff;border:none;
  padding:0.45rem;border-radius:6px;font-family:var(--font-ui);
  font-weight:700;font-size:0.76rem;cursor:pointer;transition:opacity 0.15s;
}
.notes-save:hover{opacity:0.85;}

/* Collab */
.collab-wrap{padding:0.7rem;display:flex;flex-direction:column;gap:0.65rem;}
.collab-card{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:0.9rem;}
.collab-card h4{font-size:0.8rem;font-weight:800;margin-bottom:0.65rem;}
.room-inp{
  width:100%;background:var(--bg);border:1px solid var(--border);
  color:var(--text);font-family:var(--font-code);font-size:0.73rem;
  padding:0.42rem 0.65rem;border-radius:5px;outline:none;margin-bottom:0.45rem;
  transition:border-color 0.2s;
}
.room-inp:focus{border-color:var(--blue);}
.room-btn{
  width:100%;padding:0.42rem;border:none;border-radius:5px;
  font-family:var(--font-ui);font-weight:700;font-size:0.76rem;
  cursor:pointer;transition:opacity 0.15s;margin-bottom:0.3rem;
}
.room-btn.cr{background:var(--accent);color:#fff;}
.room-btn.jo{background:var(--bg4);color:var(--text);border:1px solid var(--border);}
.room-btn:hover{opacity:0.85;}
.ulist{display:flex;flex-direction:column;gap:0.35rem;}
.upill{
  display:flex;align-items:center;gap:0.45rem;
  padding:0.38rem 0.55rem;border-radius:5px;
  background:var(--bg);border:1px solid var(--border);font-size:0.76rem;
}
.udot{width:6px;height:6px;border-radius:50%;background:var(--green);}
.uyou{margin-left:auto;font-size:0.58rem;color:var(--green);font-weight:700;}

/* Settings */
.set-wrap{padding:0.7rem;display:flex;flex-direction:column;gap:0.65rem;}
.set-grp{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:0.85rem;}
.set-grp h4{font-size:0.7rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;color:var(--text2);margin-bottom:0.65rem;}
.set-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.5rem;}
.set-row:last-child{margin-bottom:0;}
.set-label{font-size:0.78rem;font-weight:600;}
.toggle{
  width:36px;height:19px;border-radius:10px;
  background:var(--bg4);border:1px solid var(--border);
  cursor:pointer;position:relative;transition:background 0.2s;flex-shrink:0;
}
.toggle.on{background:var(--green);}
.tknob{
  width:13px;height:13px;border-radius:50%;background:#fff;
  position:absolute;top:2px;left:2px;transition:left 0.2s;
}
.toggle.on .tknob{left:19px;}
.set-sel{
  background:var(--bg);border:1px solid var(--border);color:var(--text);
  font-family:var(--font-ui);font-size:0.73rem;padding:0.28rem 0.48rem;
  border-radius:5px;outline:none;
}

/* EDITOR AREA */
.editor-area{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}

.etabs-bar{
  display:flex;align-items:center;
  background:var(--bg3);border-bottom:1px solid var(--border);
  height:34px;flex-shrink:0;overflow-x:auto;
}
.etabs-bar::-webkit-scrollbar{height:0;}
.etab{
  display:flex;align-items:center;gap:0.38rem;
  padding:0 0.9rem;height:100%;border-right:1px solid var(--border);
  font-size:0.73rem;font-family:var(--font-code);
  color:var(--text2);cursor:pointer;white-space:nowrap;
  border-bottom:2px solid transparent;transition:all 0.12s;
}
.etab.active{color:var(--text);border-bottom-color:var(--blue);background:var(--bg2);}
.edot{width:6px;height:6px;border-radius:50%;}
.etab-x{
  width:13px;height:13px;border-radius:3px;
  display:flex;align-items:center;justify-content:center;
  font-size:0.58rem;color:var(--text2);transition:all 0.12s;margin-left:0.15rem;
}
.etab-x:hover{background:var(--bg5);color:var(--text);}
.tab-add{
  padding:0 0.65rem;height:100%;border:none;background:none;
  color:var(--text2);cursor:pointer;font-size:0.95rem;transition:color 0.12s;
}
.tab-add:hover{color:var(--text);}

.cm-wrap{flex:1;overflow:hidden;}
.CodeMirror{
  height:100%!important;
  font-family:var(--font-code)!important;
  font-size:14px!important;
  line-height:1.75!important;
}
.CodeMirror-scroll{overflow-y:auto!important;}

/* AI PANEL */
.ai-panel{
  width:255px;background:var(--bg2);border-left:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;
  overflow:hidden;transition:width 0.25s;
}
.ai-panel.off{width:0;}
.ai-hd{
  padding:0.7rem 0.9rem;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;flex-shrink:0;
}
.ai-hd h3{font-size:0.76rem;font-weight:800;display:flex;align-items:center;gap:0.35rem;}
.ai-status{width:7px;height:7px;border-radius:50%;background:var(--green);animation:blink 1.5s infinite;}
.ai-body{flex:1;overflow-y:auto;padding:0.65rem;display:flex;flex-direction:column;gap:0.6rem;}
.ai-body::-webkit-scrollbar{width:3px;}
.ai-body::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
.ai-msg{padding:0.78rem;border-radius:7px;font-size:0.76rem;line-height:1.72;}
.ai-msg.sys{background:var(--bg3);border:1px solid var(--border);color:var(--text2);}
.ai-msg.hint{background:rgba(91,141,238,0.08);border:1px solid rgba(91,141,238,0.2);color:var(--text);}
.ai-msg.err{background:rgba(224,92,92,0.08);border:1px solid rgba(224,92,92,0.2);color:var(--text);}
.ai-msg.ok{background:rgba(78,203,113,0.08);border:1px solid rgba(78,203,113,0.2);color:var(--text);}
.ai-msg.loading{background:var(--bg3);border:1px solid var(--border);color:var(--text2);}
.ai-lbl{font-size:0.58rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.35rem;}
.ai-lbl.h{color:var(--blue);} .ai-lbl.e{color:var(--accent);} .ai-lbl.o{color:var(--green);}
.ai-actions{padding:0.65rem;border-top:1px solid var(--border);display:flex;gap:0.35rem;flex-shrink:0;}
.ai-btn{
  flex:1;padding:0.42rem;border:none;border-radius:5px;
  font-family:var(--font-ui);font-weight:700;font-size:0.7rem;
  cursor:pointer;transition:opacity 0.12s;
}
.ai-btn.p{background:var(--blue);color:#fff;}
.ai-btn.s{background:var(--bg3);color:var(--text);border:1px solid var(--border);}
.ai-btn:hover{opacity:0.82;}
.ai-btn:disabled{opacity:0.4;cursor:not-allowed;}
.ai-thinking{display:flex;gap:3px;align-items:center;}
.ai-dot-anim{width:5px;height:5px;border-radius:50%;background:var(--blue);animation:bounce 1s infinite;}
.ai-dot-anim:nth-child(2){animation-delay:0.15s;}
.ai-dot-anim:nth-child(3){animation-delay:0.3s;}
@keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}

/* OUTPUT */
.out-panel{
  height:195px;background:var(--bg);border-top:1px solid var(--border);
  display:flex;flex-direction:column;flex-shrink:0;transition:height 0.22s;
}
.out-panel.lg{height:340px;}
.out-panel.sm{height:110px;}
.out-bar{
  display:flex;align-items:center;
  background:var(--bg3);border-bottom:1px solid var(--border);
  height:32px;flex-shrink:0;padding:0 0.45rem;
}
.otab{
  padding:0 0.8rem;height:32px;display:flex;align-items:center;
  font-size:0.68rem;font-weight:700;color:var(--text2);cursor:pointer;
  border-bottom:2px solid transparent;transition:all 0.12s;
}
.otab.active{color:var(--text);border-bottom-color:var(--green);}
.otab:hover{color:var(--text);}
.out-bar-r{margin-left:auto;display:flex;gap:0.3rem;align-items:center;}
.oib{
  width:25px;height:25px;border-radius:4px;border:1px solid var(--border);
  background:none;color:var(--text2);cursor:pointer;font-size:0.72rem;
  display:flex;align-items:center;justify-content:center;transition:all 0.12s;
}
.oib:hover{background:var(--bg3);color:var(--text);}
#execTime{font-size:0.62rem;color:var(--text2);font-family:var(--font-code);}

.out-body{
  flex:1;overflow-y:auto;padding:0.5rem 0.85rem;
  font-family:var(--font-code);font-size:0.77rem;line-height:1.85;
}
.out-body::-webkit-scrollbar{width:3px;}
.out-body::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
.oline{display:flex;gap:0.55rem;align-items:flex-start;}
.oline.err .otxt{color:var(--accent);}
.oline.ok  .otxt{color:var(--green);}
.oline.inf .otxt{color:var(--blue);}
.oline.sys .otxt{color:var(--text2);}
.oline.wrn .otxt{color:var(--yellow);}
.oprompt{color:var(--bg5);user-select:none;flex-shrink:0;font-size:0.68rem;padding-top:0.06rem;}
.otxt{word-break:break-all;white-space:pre-wrap;}

.stdin-row{
  display:flex;align-items:center;gap:0.45rem;
  padding:0.42rem 0.85rem;border-top:1px solid var(--border);flex-shrink:0;
}
.stdin-lbl{font-family:var(--font-code);font-size:0.73rem;color:var(--green);flex-shrink:0;}
.stdin-inp{
  flex:1;background:none;border:none;outline:none;
  font-family:var(--font-code);font-size:0.76rem;color:var(--text);
}
.stdin-inp::placeholder{color:var(--text2);}

/* STATUS BAR */
.statusbar{
  height:21px;background:var(--blue);
  display:flex;align-items:center;padding:0 0.9rem;gap:1.25rem;flex-shrink:0;
}
.sitem{font-size:0.62rem;font-weight:700;color:rgba(12,14,20,0.72);display:flex;align-items:center;gap:0.28rem;}
.sitem.r{margin-left:auto;}
.save-dot{width:6px;height:6px;border-radius:50%;background:rgba(12,14,20,0.4);}
.save-dot.dirty{background:var(--yellow);}

/* MODAL */
.modal-ov{
  position:fixed;inset:0;background:rgba(0,0,0,0.72);
  backdrop-filter:blur(6px);z-index:300;
  display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity 0.2s;
}
.modal-ov.show{opacity:1;pointer-events:all;}
.modal{
  background:var(--bg2);border:1px solid var(--border2);
  border-radius:13px;width:540px;max-width:95vw;max-height:88vh;
  overflow-y:auto;transform:translateY(14px);transition:transform 0.22s;
}
.modal-ov.show .modal{transform:translateY(0);}
.modal-hd{
  padding:1.1rem 1.35rem;border-bottom:1px solid var(--border);
  display:flex;align-items:flex-start;justify-content:space-between;gap:0.75rem;
}
.modal-hd h2{font-size:1rem;font-weight:800;line-height:1.3;}
.modal-x{background:none;border:none;color:var(--text2);font-size:1rem;cursor:pointer;transition:color 0.12s;padding:0.15rem;}
.modal-x:hover{color:var(--text);}
.modal-body{padding:1.1rem 1.35rem;}
.modal-tag{font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--blue);margin-bottom:0.3rem;}
.modal-desc{font-size:0.82rem;color:var(--text2);line-height:1.7;margin-bottom:1.1rem;}
.modal-code{
  background:var(--bg);border:1px solid var(--border);border-radius:7px;
  padding:0.9rem;font-family:var(--font-code);font-size:0.73rem;
  line-height:1.85;margin-bottom:1.1rem;overflow-x:auto;white-space:pre;
}
.modal-tests{display:flex;flex-direction:column;gap:0.4rem;margin-bottom:1.1rem;}
.trow{
  background:var(--bg3);border:1px solid var(--border);
  border-radius:6px;padding:0.65rem;
}
.trow-lbl{font-size:0.6rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;color:var(--text2);margin-bottom:0.25rem;}
.trow code{font-family:var(--font-code);font-size:0.72rem;color:var(--blue);}
.trow.pass{border-color:rgba(78,203,113,0.35);}
.trow.fail{border-color:rgba(224,92,92,0.35);}
.modal-ft{
  padding:0.9rem 1.35rem;border-top:1px solid var(--border);
  display:flex;gap:0.5rem;justify-content:flex-end;
}
.mbtn{
  padding:0.45rem 1.1rem;border-radius:6px;
  font-family:var(--font-ui);font-weight:800;font-size:0.8rem;
  cursor:pointer;border:none;transition:all 0.12s;
}
.mbtn.p{background:var(--blue);color:#fff;}
.mbtn.s{background:var(--bg3);color:var(--text);border:1px solid var(--border);}
.mbtn.g{background:var(--green);color:#0c0e14;}
.mbtn:hover{opacity:0.85;transform:translateY(-1px);}

/* SHORTCUTS MODAL */
.sc-grid{display:grid;grid-template-columns:1fr 1fr;gap:0;padding:0.5rem 1.35rem 1rem;}
.sc-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:0.38rem 0;border-bottom:1px solid var(--border);
}
.sc-lbl{font-size:0.78rem;color:var(--text2);}
.sc-keys{display:flex;gap:0.25rem;}
.sc-key{
  background:var(--bg3);border:1px solid var(--border2);
  border-radius:3px;padding:0.12rem 0.4rem;
  font-family:var(--font-code);font-size:0.65rem;color:var(--text);
}

/* TOAST */
.toast{
  position:fixed;bottom:1.4rem;right:1.4rem;
  background:var(--bg3);border:1px solid var(--border2);
  border-radius:8px;padding:0.65rem 1rem;
  font-size:0.78rem;font-weight:600;
  display:flex;align-items:center;gap:0.45rem;
  transform:translateY(70px);opacity:0;
  transition:all 0.28s;z-index:998;max-width:300px;
  box-shadow:0 8px 35px rgba(0,0,0,0.4);
}
.toast.show{transform:translateY(0);opacity:1;}
.toast.ok{border-left:3px solid var(--green);}
.toast.er{border-left:3px solid var(--accent);}
.toast.inf{border-left:3px solid var(--blue);}
.toast.wn{border-left:3px solid var(--yellow);}

/* XP BADGE */
.xp-badge{
  position:fixed;top:62px;right:16px;
  background:var(--bg2);border:1px solid var(--yellow);
  border-radius:7px;padding:0.45rem 0.85rem;
  font-size:0.76rem;font-weight:700;color:var(--yellow);
  transform:translateX(110px);opacity:0;
  transition:all 0.35s;z-index:998;
}
.xp-badge.show{transform:translateX(0);opacity:1;}

/* CONFETTI */
.cprt{position:fixed;pointer-events:none;z-index:997;border-radius:2px;animation:cffall 2.2s ease-in forwards;}
@keyframes cffall{0%{transform:translateY(-20px) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(720deg);opacity:0;}}

@media(max-width:860px){.sidebar{display:none;}.ai-panel{display:none;}.lnav-links{display:none;}.ltab .ltxt{display:none;}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LANDING PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="landing">
  <nav class="lnav">
    <div class="llogo">Code<span>Professor</span></div>
    <div class="lnav-links">
      <a href="#features">Features</a>
      <a href="#languages">Languages</a>
      <a href="#challenges-sec">Challenges</a>
    </div>
    <button class="lnav-cta" onclick="launchIDE()">üöÄ Open IDE Free</button>
  </nav>

  <div class="lhero">
    <div class="lhero-bg"></div>
    <div class="lhero-grid"></div>
    <div class="lhero-inner">
      <div class="ltag"><span class="ltag-dot"></span>Free ¬∑ No Login ¬∑ No Install</div>
      <h1 class="lh1">
        The <span class="red">Smartest</span> Online<br>
        <span class="blue">Code Editor</span> for Students
      </h1>
      <p class="ldesc">
        Write, run, and learn Python, C, C++ & Java in your browser.
        Built by <strong style="color:var(--text)">Prof. Abhishek Singh</strong> ‚Äî author of 4 Python books,
        NVIDIA AI Specialist, and trainer of 3,000+ students across India.
      </p>
      <div class="lbtns">
        <button class="lbtn-p" onclick="launchIDE()">‚ñ∂ Start Coding Free</button>
        <button class="lbtn-s" onclick="launchIDE('tutorials')">üìñ Browse Tutorials</button>
      </div>
    </div>
  </div>

  <div class="lstats">
    <div class="lstat"><div class="lstat-n">4</div><div class="lstat-l">Languages</div></div>
    <div class="lstat"><div class="lstat-n">25+</div><div class="lstat-l">Tutorials</div></div>
    <div class="lstat"><div class="lstat-n">8+</div><div class="lstat-l">Challenges</div></div>
    <div class="lstat"><div class="lstat-n">AI</div><div class="lstat-l">Smart Hints</div></div>
    <div class="lstat"><div class="lstat-n">‚àû</div><div class="lstat-l">Free Forever</div></div>
  </div>

  <div class="lsec" id="features">
    <div class="lsec-tag">// Why CodeProfessor?</div>
    <div class="lsec-title">Everything a Student Needs</div>
    <div class="lsec-sub">Designed from scratch to be the editor we always wished existed ‚Äî fast, clean, and genuinely educational.</div>
    <div class="lfeat-grid">
      <div class="lfeat" style="--fc:var(--green)">
        <span class="lfeat-icon">‚ö°</span>
        <h3>Real Python 3.11 Execution</h3>
        <p>Python runs directly in your browser via Skulpt ‚Äî no installs, no server, instant execution. Works offline too.</p>
      </div>
      <div class="lfeat" style="--fc:var(--blue)">
        <span class="lfeat-icon">ü§ñ</span>
        <h3>AI Hints (Claude-Powered)</h3>
        <p>Get intelligent, context-aware hints powered by Claude AI. It reads your code and gives smart guidance.</p>
      </div>
      <div class="lfeat" style="--fc:var(--yellow)">
        <span class="lfeat-icon">üéØ</span>
        <h3>Challenges + XP System</h3>
        <p>8+ real coding challenges with auto-graded test cases and an XP points system to track progress.</p>
      </div>
      <div class="lfeat" style="--fc:var(--purple)">
        <span class="lfeat-icon">üìñ</span>
        <h3>25+ Built-in Tutorials</h3>
        <p>Step-by-step tutorials from Hello World to Decorators ‚Äî each loads directly into the editor.</p>
      </div>
      <div class="lfeat" style="--fc:var(--accent)">
        <span class="lfeat-icon">üë•</span>
        <h3>Live Collaboration</h3>
        <p>Create a room, share the ID, code together. Perfect for pair programming and classroom sessions.</p>
      </div>
      <div class="lfeat" style="--fc:var(--cyan)">
        <span class="lfeat-icon">üé®</span>
        <h3>5 Beautiful Themes</h3>
        <p>Dracula, Monokai, Material Darker, Nord, and Light mode. Your eyes, your choice.</p>
      </div>
      <div class="lfeat" style="--fc:var(--green)">
        <span class="lfeat-icon">üíæ</span>
        <h3>Auto-Save</h3>
        <p>Your code is automatically saved to your browser. Come back anytime ‚Äî your work is still there.</p>
      </div>
      <div class="lfeat" style="--fc:var(--blue)">
        <span class="lfeat-icon">‚å®Ô∏è</span>
        <h3>Pro Keyboard Shortcuts</h3>
        <p>F5 to run, Ctrl+/ to comment, code folding, bracket matching ‚Äî a real IDE experience.</p>
      </div>
      <div class="lfeat" style="--fc:var(--yellow)">
        <span class="lfeat-icon">üóÇÔ∏è</span>
        <h3>Multi-Tab Editor</h3>
        <p>Open multiple files in tabs and switch between them ‚Äî just like VS Code, in your browser.</p>
      </div>
    </div>
  </div>

  <div class="llang-strip" id="languages">
    <div class="llang-inner">
      <div class="lsec-tag">// Supported Languages</div>
      <div class="lsec-title">4 Languages, One Editor</div>
      <div class="llang-cards">
        <div class="llang-card" onclick="launchIDE('python')">
          <div class="llang-icon" style="background:rgba(53,114,165,0.15)">üêç</div>
          <div>
            <h4>Python 3.11</h4>
            <p>Live execution in browser</p>
            <span class="llang-badge live">‚óè Live Execution</span>
          </div>
        </div>
        <div class="llang-card" onclick="launchIDE('c')">
          <div class="llang-icon" style="background:rgba(85,85,85,0.15)">‚öôÔ∏è</div>
          <div>
            <h4>C (GCC 13)</h4>
            <p>Full syntax + tutorials</p>
            <span class="llang-badge syn">Syntax Highlighting</span>
          </div>
        </div>
        <div class="llang-card" onclick="launchIDE('cpp')">
          <div class="llang-icon" style="background:rgba(243,75,125,0.15)">üîß</div>
          <div>
            <h4>C++ (G++ 13)</h4>
            <p>Classes, STL, OOP</p>
            <span class="llang-badge syn">Syntax Highlighting</span>
          </div>
        </div>
        <div class="llang-card" onclick="launchIDE('java')">
          <div class="llang-icon" style="background:rgba(176,114,25,0.15)">‚òï</div>
          <div>
            <h4>Java 21</h4>
            <p>OOP, collections</p>
            <span class="llang-badge syn">Syntax Highlighting</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="lsec" id="challenges-sec">
    <div class="lsec-tag">// Challenges</div>
    <div class="lsec-title">Test Your Skills</div>
    <div class="lsec-sub">From easy warm-ups to hard algorithmic challenges ‚Äî auto-graded with XP rewards.</div>
    <div class="lfeat-grid">
      <div class="lfeat" style="--fc:var(--green)"><span class="lfeat-icon">üü¢</span><h3>Easy Challenges</h3><p>Fibonacci, Reverse String, Prime Checker ‚Äî perfect for beginners.</p></div>
      <div class="lfeat" style="--fc:var(--yellow)"><span class="lfeat-icon">üü°</span><h3>Medium Challenges</h3><p>Anagram Checker, Word Count, Stack Implementation ‚Äî intermediate level.</p></div>
      <div class="lfeat" style="--fc:var(--accent)"><span class="lfeat-icon">üî¥</span><h3>Hard Challenges</h3><p>Binary Search, Flatten Nested List ‚Äî algorithmic thinking required.</p></div>
    </div>
  </div>

  <footer class="lfooter">
    <div>
      <div class="lfooter-logo">Code<span>Professor</span></div>
      <div class="lfooter-txt" style="margin-top:0.25rem">Built by Prof. Abhishek Singh ¬∑ Jabalpur, India</div>
    </div>
    <div class="lfooter-txt">¬© 2025 CodeProfessor ¬∑ Free for all students</div>
  </footer>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     IDE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="ide">

  <!-- TOPBAR -->
  <div class="tb">
    <div class="tb-logo" onclick="showLanding()">Code<span>Professor</span></div>
    <div class="tb-div"></div>

    <div class="ltabs">
      <button class="ltab active" id="ltab-python" onclick="switchLang('python')">
        <span class="ldot" style="background:#3572a5"></span><span class="ltxt">Python</span>
      </button>
      <button class="ltab" id="ltab-c" onclick="switchLang('c')">
        <span class="ldot" style="background:#888"></span><span class="ltxt">C</span>
      </button>
      <button class="ltab" id="ltab-cpp" onclick="switchLang('cpp')">
        <span class="ldot" style="background:#f34b7d"></span><span class="ltxt">C++</span>
      </button>
      <button class="ltab" id="ltab-java" onclick="switchLang('java')">
        <span class="ldot" style="background:#b07219"></span><span class="ltxt">Java</span>
      </button>
    </div>

    <div class="tb-div"></div>
    <div class="tb-right">
      <div class="pts-chip" id="ptsChip">‚≠ê 0 XP</div>
      <div class="tb-div"></div>
      <div class="fsz-ctrl">
        <button class="fsz-btn" onclick="changeFontSize(-1)" title="Decrease font">A-</button>
        <span id="fszDisplay">14</span>
        <button class="fsz-btn" onclick="changeFontSize(1)" title="Increase font">A+</button>
      </div>
      <select class="theme-sel" id="themeSel" onchange="changeTheme(this.value)">
        <option value="dracula">üåô Dracula</option>
        <option value="monokai">üî• Monokai</option>
        <option value="material-darker">üåë Material</option>
        <option value="nord">‚ùÑÔ∏è Nord</option>
      </select>
      <button class="ib" onclick="toggleLightMode()" title="Toggle Light Mode">‚òÄÔ∏è</button>
      <button class="ib" onclick="copyCode()" title="Copy Code">üìã</button>
      <button class="ib" onclick="downloadCode()" title="Download File">üíæ</button>
      <button class="ib" onclick="showShortcuts()" title="Keyboard Shortcuts">‚å®Ô∏è</button>
      <button class="ib" onclick="toggleSidebar()" title="Toggle Sidebar">‚óÄ</button>
      <button class="ib" onclick="toggleAI()" title="AI Hints Panel">ü§ñ</button>
      <button class="run-btn" id="runBtn" onclick="runCode()">
        ‚ñ∂ Run <span class="kbd">F5</span>
      </button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="ide-main">

    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">
      <div class="stabs">
        <div class="stab active" onclick="switchPanel('tutorials',this)">üìñ Learn</div>
        <div class="stab" onclick="switchPanel('challenges',this)">üéØ Tasks</div>
        <div class="stab" onclick="switchPanel('notes',this)">üìù Notes</div>
        <div class="stab" onclick="switchPanel('collab',this)">üë• Collab</div>
        <div class="stab" onclick="switchPanel('settings',this)">‚öôÔ∏è</div>
      </div>

      <!-- TUTORIALS -->
      <div class="spanel active" id="panel-tutorials">
        <div class="tsearch"><input type="text" placeholder="üîç Search..." oninput="filterTuts(this.value)" id="tutSearch"></div>
        <div class="tlist" id="tutList"></div>
        <div class="tprog">
          <div style="display:flex;justify-content:space-between">
            <span id="progTxt">0 / 25</span>
            <span style="color:var(--green);font-weight:700" id="progPct">0%</span>
          </div>
          <div class="progbar"><div class="progfill" id="progFill" style="width:0%"></div></div>
        </div>
      </div>

      <!-- CHALLENGES -->
      <div class="spanel" id="panel-challenges">
        <div class="clist" id="chalList"></div>
      </div>

      <!-- NOTES -->
      <div class="spanel" id="panel-notes">
        <div class="notes-wrap">
          <textarea class="notes-ta" id="notesTA" placeholder="Your notes, ideas, code snippets...&#10;&#10;Auto-saved!"></textarea>
          <button class="notes-save" onclick="saveNotes()">üíæ Save Notes</button>
        </div>
      </div>

      <!-- COLLAB -->
      <div class="spanel" id="panel-collab">
        <div class="collab-wrap">
          <div class="collab-card">
            <h4>üîó Live Session</h4>
            <input class="room-inp" id="roomInp" placeholder="Room ID (e.g. prof-101)">
            <button class="room-btn cr" onclick="createRoom()">‚ú¶ Create Room</button>
            <button class="room-btn jo" onclick="joinRoom()">‚Üí Join Room</button>
          </div>
          <div class="collab-card">
            <h4>üë• Online Now</h4>
            <div class="ulist" id="ulist">
              <div class="upill"><div class="udot"></div><span>You</span><span class="uyou">YOU</span></div>
            </div>
          </div>
          <div style="padding:0.65rem;background:var(--bg3);border-radius:7px;border:1px solid var(--border);font-size:0.7rem;color:var(--text2);line-height:1.7;">
            üí° <strong style="color:var(--text)">WebSocket collab</strong> coming in v3. Share Room ID with classmates!
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div class="spanel" id="panel-settings">
        <div class="set-wrap">
          <div class="set-grp">
            <h4>Editor</h4>
            <div class="set-row"><span class="set-label">Line Numbers</span>
              <div class="toggle on" onclick="toggleSetting('lineNumbers',this)"><div class="tknob"></div></div></div>
            <div class="set-row"><span class="set-label">Auto-close Brackets</span>
              <div class="toggle on" onclick="toggleSetting('brackets',this)"><div class="tknob"></div></div></div>
            <div class="set-row"><span class="set-label">Highlight Active Line</span>
              <div class="toggle on" onclick="toggleSetting('activeLine',this)"><div class="tknob"></div></div></div>
            <div class="set-row"><span class="set-label">Code Folding</span>
              <div class="toggle on" onclick="toggleSetting('folding',this)"><div class="tknob"></div></div></div>
            <div class="set-row"><span class="set-label">Auto-complete</span>
              <div class="toggle on" onclick="toggleSetting('autocomplete',this)"><div class="tknob"></div></div></div>
          </div>
          <div class="set-grp">
            <h4>Indentation</h4>
            <div class="set-row"><span class="set-label">Tab Size</span>
              <select class="set-sel" onchange="setTabSize(this.value)">
                <option value="2">2 spaces</option>
                <option value="4" selected>4 spaces</option>
              </select>
            </div>
          </div>
          <div class="set-grp">
            <h4>About</h4>
            <div style="font-size:0.75rem;color:var(--text2);line-height:1.75">
              <strong style="color:var(--text)">CodeProfessor v2.0</strong><br>
              Prof. Abhishek Singh<br>Jabalpur, MP, India<br>
              <a href="https://pyofpython.wordpress.com" target="_blank" style="color:var(--blue)">pyofpython.wordpress.com</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- EDITOR + OUTPUT -->
    <div class="editor-area">
      <div class="etabs-bar" id="etabsBar">
        <div class="etab active" id="etab-0">
          <span class="edot" style="background:#3572a5"></span>
          <span class="etab-name">main.py</span>
        </div>
        <button class="tab-add" onclick="addTab()" title="New file">+</button>
      </div>
      <div class="cm-wrap">
        <textarea id="cmeditor"></textarea>
      </div>
      <div class="out-panel" id="outPanel">
        <div class="out-bar">
          <div class="otab active" onclick="switchOTab('console',this)">Console</div>
          <div class="otab" onclick="switchOTab('input',this)">‚å®Ô∏è Input</div>
          <div class="otab" onclick="switchOTab('history',this)">üìú History</div>
          <div class="out-bar-r">
            <span id="execTime"></span>
            <button class="oib" onclick="clearOutput()" title="Clear">üóë</button>
            <button class="oib" onclick="cycleOutput()" title="Resize" id="resizeBtn">‚¨Ü</button>
          </div>
        </div>
        <div class="out-body" id="outBody">
          <div class="oline sys"><span class="oprompt">¬ª</span><span class="otxt">CodeProfessor v2.0 ‚Äî Loading Python 3.11...</span></div>
        </div>
        <div class="stdin-row" id="stdinRow" style="display:none">
          <span class="stdin-lbl">stdin ‚Ä∫</span>
          <input class="stdin-inp" id="stdinInp" placeholder="Type input and press Enter..." onkeydown="handleStdin(event)">
        </div>
      </div>
    </div>

    <!-- AI PANEL -->
    <div class="ai-panel" id="aiPanel">
      <div class="ai-hd">
        <h3><span class="ai-status"></span> AI Assistant</h3>
        <button class="oib" onclick="toggleAI()" style="width:22px;height:22px;font-size:0.65rem">‚úï</button>
      </div>
      <div class="ai-body" id="aiBody">
        <div class="ai-msg sys">
          <div class="ai-lbl h">Assistant</div>
          Hi! I'm powered by Claude AI. Run your code and I'll analyze errors, give smart hints, and explain concepts. Click <strong>Hint</strong> anytime!
        </div>
      </div>
      <div class="ai-actions">
        <button class="ai-btn p" id="hintBtn" onclick="getAIHint()">üí° Hint</button>
        <button class="ai-btn s" id="explainBtn" onclick="explainCode()">üîç Explain</button>
        <button class="ai-btn s" onclick="clearAI()">üóë</button>
      </div>
    </div>
  </div>

  <!-- STATUS BAR -->
  <div class="statusbar">
    <div class="save-dot" id="saveDot"></div>
    <div class="sitem" id="statusReady">‚óè Ready</div>
    <div class="sitem" id="statusLang">üêç Python 3.11</div>
    <div class="sitem" id="statusCursor">Ln 1, Col 1</div>
    <div class="sitem r">F5 Run ¬∑ Ctrl+/ Comment ¬∑ Ctrl+S Save</div>
  </div>
</div>

<!-- PYODIDE LOADER -->
<div id="pyLoader">
  <div class="loader-spin"></div>
  <span>Loading Python 3.11...</span>
</div>

<!-- TUTORIAL / CHALLENGE MODAL -->
<div class="modal-ov" id="mainModal">
  <div class="modal">
    <div class="modal-hd">
      <div>
        <div class="modal-tag" id="mTag"></div>
        <h2 id="mTitle"></h2>
      </div>
      <button class="modal-x" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="modal-desc" id="mDesc"></div>
      <div class="modal-code" id="mCode" style="display:none"></div>
      <div id="mTests"></div>
    </div>
    <div class="modal-ft" id="mFt"></div>
  </div>
</div>

<!-- SHORTCUTS MODAL -->
<div class="modal-ov" id="scModal">
  <div class="modal" style="width:600px">
    <div class="modal-hd"><h2>‚å®Ô∏è Keyboard Shortcuts</h2><button class="modal-x" onclick="document.getElementById('scModal').classList.remove('show')">‚úï</button></div>
    <div class="sc-grid">
      <div class="sc-row"><span class="sc-lbl">Run code</span><div class="sc-keys"><span class="sc-key">F5</span><span class="sc-key">Ctrl+Enter</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Toggle comment</span><div class="sc-keys"><span class="sc-key">Ctrl+/</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Save</span><div class="sc-keys"><span class="sc-key">Ctrl+S</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Undo</span><div class="sc-keys"><span class="sc-key">Ctrl+Z</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Find</span><div class="sc-keys"><span class="sc-key">Ctrl+F</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Toggle sidebar</span><div class="sc-keys"><span class="sc-key">Ctrl+B</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Toggle AI</span><div class="sc-keys"><span class="sc-key">Ctrl+I</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Clear output</span><div class="sc-keys"><span class="sc-key">Ctrl+L</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Font size +</span><div class="sc-keys"><span class="sc-key">Ctrl+=</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Font size -</span><div class="sc-keys"><span class="sc-key">Ctrl+-</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Indent</span><div class="sc-keys"><span class="sc-key">Tab</span></div></div>
      <div class="sc-row"><span class="sc-lbl">Dedent</span><div class="sc-keys"><span class="sc-key">Shift+Tab</span></div></div>
    </div>
    <div class="modal-ft"><button class="mbtn s" onclick="document.getElementById('scModal').classList.remove('show')">Close</button></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="xp-badge" id="xpBadge"></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TUTORIAL DATA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const TUTORIALS = [
  {id:'py_hello',  lang:'python', group:'üêç Python Basics', title:'Hello, World!',           level:'e', desc:'Every programming journey starts here. print() sends text to the console.', code:`# Hello World in Python\nprint("Hello, World!")\nprint("Welcome to CodeProfessor! üöÄ")\n\nname = "Student"\nprint("Hello,", name)\n\nage = 18\nprint(f"I am {age} years old and I code in Python!")`},
  {id:'py_vars',   lang:'python', group:'üêç Python Basics', title:'Variables & Data Types',  level:'e', desc:'Python is dynamically typed. Variables can hold any type.', code:`x = 42\npi = 3.14159\nname = "CodeProfessor"\nis_fun = True\nnothing = None\n\nprint(type(x), type(pi), type(name))\nprint(type(is_fun), type(nothing))\n\na, b, c = 10, 20, 30\nprint(a + b + c)\n\nnum = int("100")\nprint(num * 2)`},
  {id:'py_str',    lang:'python', group:'üêç Python Basics', title:'Strings & Methods',       level:'e', desc:'Strings are immutable sequences. Python has dozens of built-in string methods.', code:`s = "Hello, CodeProfessor!"\nprint(len(s))\nprint(s.upper())\nprint(s.lower())\nprint(s[0:5])\nprint(s[::-1])\nprint(s.replace("Hello","Hi"))\nprint(s.split(", "))\nprint("  spaces  ".strip())\nprint(s.startswith("Hello"))\nprint("Prof" in s)\n\nname, score = "Alice", 95\nprint(f"{name} scored {score}/100")\nprint("-" * 30)\nwords = ["Python","is","fun"]\nprint(" ".join(words))`},
  {id:'py_loops',  lang:'python', group:'üêç Python Basics', title:'For & While Loops',       level:'e', desc:'Loops repeat code. Python\'s for loop iterates over any iterable.', code:`for i in range(1, 6):\n    print(i, end=" ")\nprint()\n\nfruits = ["Apple","Banana","Cherry"]\nfor fruit in fruits:\n    print(fruit)\n\ncount = 5\nwhile count > 0:\n    print(count, end=" ")\n    count -= 1\nprint("Go!")\n\nfor i, fruit in enumerate(fruits, start=1):\n    print(f"{i}. {fruit}")\n\nsquares = [x**2 for x in range(1, 8)]\nprint(squares)`},
  {id:'py_funcs',  lang:'python', group:'üêç Python Basics', title:'Functions',               level:'e', desc:'Functions are reusable blocks of code. In Python they are first-class citizens.', code:`def greet(name, greeting="Hello"):\n    return f"{greeting}, {name}!"\n\nprint(greet("Alice"))\nprint(greet("Bob", "Hi"))\n\ndef total(*numbers):\n    return sum(numbers)\n\nprint(total(1,2,3,4,5))\n\ndef info(**kwargs):\n    for k,v in kwargs.items():\n        print(f"  {k}: {v}")\n\ninfo(name="Alice", age=20)\n\nsquare = lambda x: x**2\nprint(square(7))\n\ndef factorial(n):\n    return 1 if n<=1 else n*factorial(n-1)\n\nfor i in range(1,8):\n    print(f"{i}! = {factorial(i)}")`},
  {id:'py_lists',  lang:'python', group:'üêç Python Basics', title:'Lists & Comprehensions',  level:'e', desc:'Lists are ordered, mutable sequences ‚Äî Python\'s most versatile data structure.', code:`nums = [3,1,4,1,5,9,2,6]\nprint(len(nums), sum(nums), min(nums), max(nums))\n\nnums.append(7)\nnums.sort()\nprint(nums)\n\nprint(nums[:3])\nprint(nums[-3:])\nprint(nums[::-1])\n\nmatrix = [[1,2,3],[4,5,6],[7,8,9]]\nfor row in matrix:\n    print(row)\n\nsquares = [x**2 for x in range(1,11)]\nprint(squares)\n\nprimes = [x for x in range(2,30) if all(x%i!=0 for i in range(2,x))]\nprint(primes)`},
  {id:'py_dicts',  lang:'python', group:'üêç Python Basics', title:'Dictionaries & Sets',    level:'m', desc:'Dictionaries store key-value pairs. Sets store unique unordered elements.', code:`student = {"name":"Alice","age":20,"grades":[85,92,78]}\nprint(student["name"])\nprint(student.get("gpa","N/A"))\n\nstudent["gpa"] = 8.9\nfor k,v in student.items():\n    print(f"  {k}: {v}")\n\nsquares = {x: x**2 for x in range(1,6)}\nprint(squares)\n\na = {1,2,3,4,5}\nb = {3,4,5,6,7}\nprint(a | b)\nprint(a & b)\nprint(a - b)`},
  {id:'py_oop1',   lang:'python', group:'üèóÔ∏è OOP', title:'Classes & Objects',              level:'m', desc:'OOP organizes code into classes (blueprints) and objects (instances).', code:`class BankAccount:\n    bank_name = "CodeBank"\n\n    def __init__(self, owner, balance=0):\n        self.owner = owner\n        self.balance = balance\n        self._transactions = []\n\n    def deposit(self, amount):\n        self.balance += amount\n        self._transactions.append(f"+{amount}")\n        return self\n\n    def withdraw(self, amount):\n        if amount > self.balance:\n            raise ValueError("Insufficient funds!")\n        self.balance -= amount\n        self._transactions.append(f"-{amount}")\n        return self\n\n    def __str__(self):\n        return f"Account({self.owner}, Rs.{self.balance})"\n\nacc = BankAccount("Alice", 1000)\nacc.deposit(500).withdraw(200)\nprint(acc)\nprint("Transactions:", acc._transactions)`},
  {id:'py_oop2',   lang:'python', group:'üèóÔ∏è OOP', title:'Inheritance & Polymorphism',    level:'m', desc:'Inheritance lets a class extend another. Polymorphism allows subclasses to override methods.', code:`class Shape:\n    def area(self): raise NotImplementedError\n    def describe(self):\n        print(f"{type(self).__name__}: area = {self.area():.2f}")\n\nclass Circle(Shape):\n    def __init__(self, r): self.r = r\n    def area(self): return 3.14159 * self.r**2\n\nclass Rectangle(Shape):\n    def __init__(self, w, h): self.w=w; self.h=h\n    def area(self): return self.w * self.h\n\nclass Triangle(Shape):\n    def __init__(self, b, h): self.b=b; self.h=h\n    def area(self): return 0.5*self.b*self.h\n\nfor shape in [Circle(5), Rectangle(4,6), Triangle(3,8)]:\n    shape.describe()`},
  {id:'py_deco',   lang:'python', group:'‚öôÔ∏è Advanced', title:'Decorators',                level:'h', desc:'Decorators wrap functions to add behavior without modifying their source code.', code:`import time\nfrom functools import wraps\n\ndef timer(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        start = time.time()\n        result = func(*args, **kwargs)\n        print(f"  {func.__name__}() took {time.time()-start:.4f}s")\n        return result\n    return wrapper\n\ndef repeat(n):\n    def deco(func):\n        @wraps(func)\n        def wrapper(*args,**kwargs):\n            for _ in range(n): result = func(*args,**kwargs)\n            return result\n        return wrapper\n    return deco\n\n@timer\ndef compute(n):\n    return sum(i**2 for i in range(n))\n\n@repeat(3)\ndef say_hi(): print("Hello!")\n\ncompute(100000)\nsay_hi()`},
  {id:'py_gen',    lang:'python', group:'‚öôÔ∏è Advanced', title:'Generators',                level:'h', desc:'Generators produce values lazily ‚Äî saving memory for large datasets.', code:`def fibonacci():\n    a, b = 0, 1\n    while True:\n        yield a\n        a, b = b, a+b\n\nfib = fibonacci()\nprint([next(fib) for _ in range(12)])\n\ndef count_up(start, end):\n    while start <= end:\n        yield start\n        start += 1\n\nfor n in count_up(1, 5):\n    print(n, end=" ")\nprint()\n\nimport sys\nbig_list = [x**2 for x in range(10000)]\nbig_gen  = (x**2 for x in range(10000))\nprint(f"List: {sys.getsizeof(big_list):,} bytes")\nprint(f"Gen:  {sys.getsizeof(big_gen):,} bytes")`},
  {id:'py_except', lang:'python', group:'‚öôÔ∏è Advanced', title:'Exception Handling',        level:'m', desc:'Handle runtime errors gracefully using try/except blocks.', code:`def safe_divide(a, b):\n    try:\n        result = a / b\n    except ZeroDivisionError:\n        return "Error: Cannot divide by zero"\n    except TypeError as e:\n        return f"Error: {e}"\n    else:\n        return result\n    finally:\n        print("  divide() called")\n\nprint(safe_divide(10, 2))\nprint(safe_divide(10, 0))\nprint(safe_divide("x", 2))\n\nclass InsufficientFunds(Exception):\n    def __init__(self, amount, balance):\n        super().__init__(f"Need Rs.{amount}, have Rs.{balance}")\n        self.shortfall = amount - balance\n\ntry:\n    raise InsufficientFunds(500, 200)\nexcept InsufficientFunds as e:\n    print(e)\n    print(f"Shortfall: Rs.{e.shortfall}")`},
  {id:'c_hello',   lang:'c',      group:'‚öôÔ∏è C Language', title:'Hello World in C',         level:'e', desc:'C is a compiled, statically-typed language. Every program starts from main().', code:`#include <stdio.h>\n\nint factorial(int n) {\n    if (n <= 1) return 1;\n    return n * factorial(n - 1);\n}\n\nint main() {\n    printf("Hello, World!\\n");\n    printf("CodeProfessor - C Editor\\n\\n");\n\n    int age = 20;\n    float gpa = 8.75;\n    char name[] = "Student";\n\n    printf("Name: %s\\n", name);\n    printf("Age:  %d\\n", age);\n    printf("GPA:  %.2f\\n\\n", gpa);\n\n    printf("Factorials:\\n");\n    for (int i = 1; i <= 8; i++) {\n        printf("  %d! = %d\\n", i, factorial(i));\n    }\n    return 0;\n}`},
  {id:'cpp_class', lang:'cpp',    group:'üîß C++',        title:'Classes in C++',           level:'m', desc:'C++ extends C with classes, templates, and the STL.', code:`#include <iostream>\n#include <string>\n#include <vector>\nusing namespace std;\n\nclass Student {\nprivate:\n    string name;\n    int age;\n    float gpa;\npublic:\n    Student(string n, int a, float g) : name(n), age(a), gpa(g) {}\n\n    void display() {\n        cout << "Name: " << name << endl;\n        cout << "Age:  " << age  << endl;\n        cout << "GPA:  " << gpa  << endl;\n    }\n\n    bool isHonors() { return gpa >= 8.5; }\n};\n\nint main() {\n    Student s("Alice", 20, 9.2);\n    s.display();\n    cout << "Honors: " << (s.isHonors()?"Yes":"No") << endl;\n    return 0;\n}`},
  {id:'java_hello',lang:'java',   group:'‚òï Java',        title:'Hello World in Java',      level:'e', desc:'Java is strongly-typed OOP. Every program needs a class with a main method.', code:`public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, World!");\n        System.out.println("CodeProfessor - Java Editor");\n\n        String name = "Student";\n        int age = 20;\n        double gpa = 8.75;\n\n        System.out.println("\\nStudent Info:");\n        System.out.println("Name : " + name);\n        System.out.println("Age  : " + age);\n        System.out.printf("GPA  : %.2f%n", gpa);\n    }\n}`},
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHALLENGE DATA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CHALLENGES = [
  {id:'ch_fib',    title:'Fibonacci Sequence',      level:'e', pts:50,  tags:['loops','lists'],
   desc:'Write fibonacci(n) that returns the first n Fibonacci numbers as a list.',
   hint:'Start with a list [0,1] and keep appending the sum of the last two elements.',
   tests:[{i:'fibonacci(5)',expected:'[0, 1, 1, 2, 3]'},{i:'fibonacci(1)',expected:'[0]'},{i:'fibonacci(8)',expected:'[0, 1, 1, 2, 3, 5, 8, 13]'}],
   starter:`def fibonacci(n):\n    # Write your code here\n    pass\n\nprint(fibonacci(8))`},
  {id:'ch_rev',    title:'Reverse Without Slicing',  level:'e', pts:40,  tags:['strings'],
   desc:'Write reverse_str(s) that reverses a string WITHOUT using [::-1] or reversed().',
   hint:'Use a loop to build the reversed string character by character from the end.',
   tests:[{i:'reverse_str("hello")',expected:'"olleh"'},{i:'reverse_str("Python")',expected:'"nohtyP"'},{i:'reverse_str("a")',expected:'"a"'}],
   starter:`def reverse_str(s):\n    # No slicing allowed!\n    pass\n\nprint(reverse_str("Python"))`},
  {id:'ch_prime',  title:'Is Prime?',                level:'e', pts:60,  tags:['math','loops'],
   desc:'Write is_prime(n) returning True if n is prime. Optimize for large numbers.',
   hint:'Only check divisors up to sqrt(n). Skip even numbers after checking 2.',
   tests:[{i:'is_prime(7)',expected:'True'},{i:'is_prime(15)',expected:'False'},{i:'is_prime(97)',expected:'True'},{i:'is_prime(1)',expected:'False'}],
   starter:`def is_prime(n):\n    pass\n\nfor n in [1,2,7,10,97]:\n    print(f"is_prime({n}) = {is_prime(n)}")`},
  {id:'ch_anagram',title:'Anagram Checker',          level:'m', pts:80,  tags:['strings','dicts'],
   desc:'Write is_anagram(s1,s2) returning True if both strings are anagrams. Case-insensitive.',
   hint:'Two strings are anagrams if they have the same character frequencies. Try sorting or using a dict.',
   tests:[{i:'is_anagram("listen","silent")',expected:'True'},{i:'is_anagram("hello","world")',expected:'False'},{i:'is_anagram("Race","Care")',expected:'True'}],
   starter:`def is_anagram(s1, s2):\n    pass\n\nprint(is_anagram("listen","silent"))\nprint(is_anagram("hello","world"))`},
  {id:'ch_flatten',title:'Flatten Nested List',      level:'m', pts:100, tags:['lists','recursion'],
   desc:'Write flatten(lst) that flattens a deeply nested list into a flat list.',
   hint:'Use recursion. If an element is a list, recurse into it. Otherwise append it.',
   tests:[{i:'flatten([1,[2,[3,4]],5])',expected:'[1, 2, 3, 4, 5]'},{i:'flatten([[1,2],[3,[4,5]]])',expected:'[1, 2, 3, 4, 5]'}],
   starter:`def flatten(lst):\n    pass\n\nprint(flatten([1,[2,[3,4]],5]))`},
  {id:'ch_stack',  title:'Implement a Stack',        level:'m', pts:110, tags:['OOP','data structures'],
   desc:'Implement a Stack class with push(x), pop(), peek(), is_empty(), size() methods.',
   hint:'Use a Python list internally. push appends to the end, pop removes from the end.',
   tests:[{i:'s=Stack();s.push(1);s.push(2);s.pop()',expected:'2'},{i:'s=Stack();s.push(5);s.peek()',expected:'5'},{i:'s=Stack();s.is_empty()',expected:'True'}],
   starter:`class Stack:\n    def __init__(self): pass\n    def push(self,x): pass\n    def pop(self): pass\n    def peek(self): pass\n    def is_empty(self): pass\n    def size(self): pass\n\ns = Stack()\ns.push(10);s.push(20);s.push(30)\nprint("Size:",s.size())\nprint("Peek:",s.peek())\nprint("Pop:",s.pop())`},
  {id:'ch_wcount', title:'Word Frequency',            level:'m', pts:90,  tags:['dicts','strings'],
   desc:'Write word_count(text) returning a dict of word frequencies (case-insensitive).',
   hint:'Split by spaces, lowercase each word, strip punctuation, then count with a dict.',
   tests:[{i:'word_count("the cat sat on the mat")["the"]',expected:'2'},{i:'word_count("Hello hello HELLO")["hello"]',expected:'3'}],
   starter:`def word_count(text):\n    pass\n\nresult = word_count("the cat sat on the mat")\nprint(sorted(result.items(),key=lambda x:-x[1]))`},
  {id:'ch_binary', title:'Binary Search',            level:'h', pts:130, tags:['algorithms'],
   desc:'Implement binary_search(arr, target) on a sorted array. Return index if found, -1 otherwise. Must be O(log n).',
   hint:'Compare target with the middle element. Narrow search to left or right half each iteration.',
   tests:[{i:'binary_search([1,3,5,7,9,11],7)',expected:'3'},{i:'binary_search([2,4,6,8,10],5)',expected:'-1'},{i:'binary_search([1,2,3,4,5],1)',expected:'0'}],
   starter:`def binary_search(arr, target):\n    # O(log n) please!\n    pass\n\nprint(binary_search([1,3,5,7,9,11],7))\nprint(binary_search([1,3,5,7,9,11],6))`},
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let editor;
let currentLang = 'python';
let currentTheme = 'dracula';
let fontSize = 14;
let sidebarOpen = true, aiOpen = true;
let outputSize = 0;
let userPoints = 0;
let completedTuts = new Set();
let solvedChals = new Set();
let notes = '';
let runHistory = [];
let modalData = null;
let settings = { lineNumbers:true, brackets:true, activeLine:true, folding:true, autocomplete:true };
let lastError = '';
let lastCode = '';
let tabCount = 0;
let isLightMode = false;

const LANG_CFG = {
  python:{ mode:'python',          file:'main.py',   dot:'#3572a5', status:'üêç Python 3 (Skulpt)', ext:'.py' },
  c:     { mode:'text/x-csrc',     file:'main.c',    dot:'#888888', status:'‚öôÔ∏è C ‚Äî GCC 13',  ext:'.c'  },
  cpp:   { mode:'text/x-c++src',   file:'main.cpp',  dot:'#f34b7d', status:'üîß C++ ‚Äî G++ 13', ext:'.cpp'},
  java:  { mode:'text/x-java',     file:'Main.java', dot:'#b07219', status:'‚òï Java 21',      ext:'.java'},
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
window.addEventListener('load', () => {
  // Restore saved state
  try {
    const s = JSON.parse(localStorage.getItem('cp_v2')||'{}');
    if(s.pts)   userPoints = s.pts;
    if(s.tuts)  completedTuts = new Set(s.tuts);
    if(s.chals) solvedChals   = new Set(s.chals);
    if(s.notes) notes = s.notes;
    if(s.fsz)   fontSize = s.fsz;
    if(s.theme) currentTheme = s.theme;
  } catch(e){}

  // Init CodeMirror
  editor = CodeMirror.fromTextArea(document.getElementById('cmeditor'), {
    lineNumbers: true,
    theme: currentTheme,
    mode: 'python',
    autoCloseBrackets: true,
    matchBrackets: true,
    styleActiveLine: true,
    indentUnit: 4, tabSize: 4,
    indentWithTabs: false,
    lineWrapping: false,
    foldGutter: true,
    gutters: ['CodeMirror-linenumbers','CodeMirror-foldgutter'],
    extraKeys: {
      'F5':         runCode,
      'Ctrl-Enter': runCode,
      'Ctrl-/':     cm => cm.execCommand('toggleComment'),
      'Ctrl-S':     saveCode,
      'Ctrl-B':     toggleSidebar,
      'Ctrl-I':     toggleAI,
      'Ctrl-L':     clearOutput,
      'Ctrl-=':     () => changeFontSize(1),
      'Ctrl--':     () => changeFontSize(-1),
      'Tab':        cm => { if(cm.somethingSelected()) cm.indentSelection('add'); else cm.execCommand('indentMore'); },
      'Shift-Tab':  cm => cm.execCommand('indentLess'),
    }
  });

  // BLANK EDITOR on start
  editor.setValue('');
  editor.focus();

  // Restore appearance
  editor.getWrapperElement().style.fontSize = fontSize+'px';
  document.getElementById('fszDisplay').textContent = fontSize;
  document.getElementById('themeSel').value = currentTheme;

  // Cursor tracking
  editor.on('cursorActivity', () => {
    const c = editor.getCursor();
    document.getElementById('statusCursor').textContent = `Ln ${c.line+1}, Col ${c.ch+1}`;
  });

  // Auto-save
  editor.on('change', () => {
    document.getElementById('saveDot').classList.add('dirty');
    clearTimeout(editor._st);
    editor._st = setTimeout(saveCode, 1800);
  });

  // Auto-complete
  editor.on('inputRead', (cm, ch) => {
    if(settings.autocomplete && ch.text[0]?.match(/[\w.]/)) {
      setTimeout(()=>cm.showHint({hint:CodeMirror.hint.anyword,completeSingle:false}),120);
    }
  });

  // Notes
  document.getElementById('notesTA').value = notes;
  updatePointsDisplay();
  renderTutorials();
  renderChallenges();
  updateProgress();

  // Init Python engine (instant, no loading)
  initPython();
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PYTHON ENGINE ‚Äî Skulpt (instant, no download)
   Works offline and online immediately.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initPython() {
  // Skulpt is already loaded via CDN script tag ‚Äî no async init needed
  document.getElementById('pyLoader').classList.add('hide');
  addLine('sys', '‚úì Python 3 ready ‚Äî press F5 or click Run.');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RUN CODE ‚Äî Works immediately, no loading
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function runCode() {
  const code = editor.getValue().trim();
  if (!code) { showToast('Editor is empty ‚Äî write some code first!','wn'); return; }

  clearOutput();

  if (currentLang !== 'python') {
    addLine('inf', LANG_CFG[currentLang].status + ' ‚Äî Syntax Highlighting Active');
    addLine('sys', '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
    addLine('sys', 'Full syntax highlighting, code folding, and all editor features work.');
    addLine('sys', 'Live compilation for C / C++ / Java needs a server backend.');
    addLine('inf', 'üí° Switch to Python for instant in-browser execution.');
    addLine('sys', 'Backend (Judge0 API) integration planned for v3.');
    return;
  }

  const btn = document.getElementById('runBtn');
  btn.classList.add('busy');
  btn.textContent = '‚è≥ Running...';
  document.getElementById('statusReady').textContent = '‚óè Running';
  document.getElementById('execTime').textContent = '';

  lastCode = code;
  lastError = '';
  runHistory.unshift({ code, time: new Date().toLocaleTimeString() });
  if (runHistory.length > 30) runHistory.pop();

  addLine('sys', '‚ñ∂ Running Python...');
  const t0 = performance.now();

  // Configure Skulpt
  Sk.configure({
    output: function(text) {
      // Split on newlines, print each non-empty line
      String(text).split('\n').forEach(line => {
        if (line !== '') addLine('ok', line);
      });
    },
    read: function(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles.files[x] === undefined)
        throw "File not found: '" + x + "'";
      return Sk.builtinFiles.files[x];
    },
    __future__: Sk.python3,
    execLimit: 10000,  // 10 second execution limit
  });

  const promise = Sk.misceval.asyncToPromise(function() {
    return Sk.importMainWithBody('<stdin>', false, code, true);
  });

  promise.then(function() {
    const elapsed = Math.round(performance.now() - t0);
    document.getElementById('execTime').textContent = elapsed + 'ms';
    addLine('sys', '‚úì Finished in ' + elapsed + 'ms');
    document.getElementById('statusReady').textContent = '‚óè Ready';
    updateAISuccess();
    resetRunBtn();
  }).catch(function(err) {
    const raw = err.toString();
    // Skulpt wraps errors ‚Äî extract the readable message
    const match = raw.match(/([A-Za-z]+Error[^\n]*)/);
    const clean = match ? match[1] : raw.replace(/^.*\n/,'').trim();
    lastError = clean;
    addLine('err', clean);
    // Show line number if available
    if (err.traceback && err.traceback.length) {
      const tb = err.traceback[err.traceback.length - 1];
      addLine('err', '  ‚Üí Line ' + tb.lineno + (tb.colno ? ', Col ' + tb.colno : ''));
    }
    document.getElementById('statusReady').textContent = '‚óè Error';
    updateAIError(clean);
    showToast('Error ‚Äî check AI Hints panel!', 'er');
    resetRunBtn();
  });
}

function resetRunBtn() {
  const btn = document.getElementById('runBtn');
  btn.classList.remove('busy');
  btn.innerHTML = '‚ñ∂ Run <span class="kbd">F5</span>';
}

function addLine(type, text) {
  const body = document.getElementById('outBody');
  const d = document.createElement('div');
  d.className = `oline ${type}`;
  d.innerHTML = `<span class="oprompt">${type==='err'?'‚úó':type==='ok'?'‚Ä∫':'¬ª'}</span><span class="otxt">${esc(text)}</span>`;
  body.appendChild(d);
  body.scrollTop = body.scrollHeight;
}

function clearOutput() {
  document.getElementById('outBody').innerHTML = '';
  document.getElementById('execTime').textContent = '';
}

function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AI HINTS ‚Äî Smart local engine
   (No API key needed, works offline)
   Genuinely analyzes code patterns.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addAIMsg(type, html) {
  const b = document.getElementById('aiBody');
  const m = document.createElement('div');
  m.className = `ai-msg ${type}`;
  m.innerHTML = html;
  b.appendChild(m);
  b.scrollTop = b.scrollHeight;
  return m;
}

function setAIBusy(busy) {
  document.getElementById('hintBtn').disabled = busy;
  document.getElementById('explainBtn').disabled = busy;
}

// Full local AI hint engine ‚Äî analyzes actual code content
function analyzeCode(code) {
  const lines = code.split('\n');
  const hints = [];

  // ‚îÄ‚îÄ Error-based hints ‚îÄ‚îÄ
  if (lastError) {
    if (lastError.includes('SyntaxError') || lastError.includes('invalid syntax'))
      return [{ type:'err', msg:'<strong>SyntaxError:</strong> Check for a missing colon <code>:</code> after <code>if</code>, <code>for</code>, <code>def</code>, or <code>class</code>. Also check for unmatched parentheses <code>()</code> or brackets <code>[]</code>.' }];
    if (lastError.includes('IndentationError'))
      return [{ type:'err', msg:'<strong>IndentationError:</strong> Python uses 4 spaces for indentation. Make sure every block inside <code>if</code>, <code>for</code>, <code>def</code>, etc. is consistently indented.' }];
    if (lastError.includes('NameError'))
      return [{ type:'err', msg:'<strong>NameError:</strong> You\'re using a variable or function that hasn\'t been defined yet. Check your spelling ‚Äî Python is case-sensitive. Define variables before using them.' }];
    if (lastError.includes('TypeError'))
      return [{ type:'err', msg:'<strong>TypeError:</strong> You\'re mixing incompatible types. For example, you cannot add a string and an integer directly. Use <code>int()</code>, <code>str()</code>, or <code>float()</code> to convert.' }];
    if (lastError.includes('IndexError'))
      return [{ type:'err', msg:'<strong>IndexError:</strong> You\'re accessing an index that doesn\'t exist. Python lists start at index <code>0</code>. The last valid index is <code>len(list) - 1</code>. Check your loop range too.' }];
    if (lastError.includes('ZeroDivisionError'))
      return [{ type:'err', msg:'<strong>ZeroDivisionError:</strong> Division by zero is not allowed. Add a guard before dividing:<br><code>if divisor != 0: result = a / divisor</code>' }];
    if (lastError.includes('KeyError'))
      return [{ type:'err', msg:'<strong>KeyError:</strong> The dictionary key doesn\'t exist. Use <code>dict.get(key, default)</code> for safe access, or check with <code>if key in dict:</code> first.' }];
    if (lastError.includes('AttributeError'))
      return [{ type:'err', msg:'<strong>AttributeError:</strong> You\'re calling a method or attribute that doesn\'t exist on this object. Check the variable type with <code>print(type(variable))</code>.' }];
    if (lastError.includes('ValueError'))
      return [{ type:'err', msg:'<strong>ValueError:</strong> A function received an argument of the right type but wrong value. For example, <code>int("hello")</code> fails because "hello" is not a number.' }];
    if (lastError.includes('RecursionError'))
      return [{ type:'err', msg:'<strong>RecursionError:</strong> Your recursive function is calling itself infinitely. Make sure you have a correct base case that stops the recursion.' }];
    if (lastError.includes('ImportError') || lastError.includes('ModuleNotFound'))
      return [{ type:'err', msg:'<strong>ImportError:</strong> The module you\'re trying to import is not available in this browser environment. Standard library modules like <code>math</code>, <code>random</code>, <code>time</code>, <code>sys</code> work. Third-party packages like <code>numpy</code> do not.' }];
    return [{ type:'err', msg:'An error occurred. Add <code>print()</code> statements before the error line to check what your variables contain at each step.' }];
  }

  // ‚îÄ‚îÄ Style & improvement hints ‚îÄ‚îÄ
  // Using range(len()) instead of enumerate
  if (/range\(len\(/.test(code))
    hints.push({ type:'hint', msg:'üí° <strong>Pythonic tip:</strong> Instead of <code>for i in range(len(lst))</code>, use <code>for i, val in enumerate(lst)</code> to get both index and value.' });

  // String concatenation in loop
  if (/\+= /.test(code) && /for .+ in/.test(code) && /str/.test(code))
    hints.push({ type:'hint', msg:'üí° Building a string by concatenating in a loop is slow. Use a list and <code>"".join(list)</code> at the end ‚Äî it\'s much faster.' });

  // == None instead of is None
  if (/== None/.test(code) || /!= None/.test(code))
    hints.push({ type:'hint', msg:'üí° Use <code>is None</code> and <code>is not None</code> instead of <code>== None</code>. None is a singleton in Python ‚Äî identity check is correct.' });

  // print with + instead of f-string
  if (/print\(.*\+.*\)/.test(code) && !code.includes('f"') && !code.includes("f'"))
    hints.push({ type:'hint', msg:'üí° Use f-strings for cleaner output: instead of <code>print("Hello " + name)</code> write <code>print(f"Hello {name}")</code>.' });

  // Missing docstring on function
  if (/^def /.test(code) && !/"""/.test(code) && !/"/.test(code.split('def ')[1]?.split('\n')[1]||''))
    hints.push({ type:'hint', msg:'üí° Add docstrings to your functions: right after <code>def func():</code> add <code>"""What this function does."""</code> on the next line.' });

  // Mutable default argument (classic bug)
  if (/def .+\(.*=\[\]/.test(code) || /def .+\(.*=\{\}/.test(code))
    hints.push({ type:'hint', msg:'‚ö†Ô∏è <strong>Common bug:</strong> Never use mutable defaults like <code>def f(lst=[])</code> ‚Äî the same list is reused every call. Use <code>def f(lst=None)</code> then <code>if lst is None: lst = []</code>.' });

  // Long function (no return)
  if (lines.length > 15 && /^def /.test(code) && !code.includes('return'))
    hints.push({ type:'hint', msg:'üí° Your function doesn\'t return a value. If it should produce a result, use <code>return</code> at the end. Functions without <code>return</code> return <code>None</code>.' });

  // No error handling
  if ((code.includes('open(') || code.includes('int(input')) && !code.includes('try:'))
    hints.push({ type:'hint', msg:'üí° Consider wrapping risky operations in a <code>try/except</code> block to handle errors gracefully.' });

  // Nested loops ‚Äî suggest optimization
  if ((code.match(/for .+ in/g)||[]).length >= 2)
    hints.push({ type:'hint', msg:'üí° You have nested loops ‚Äî this is O(n¬≤). For large data, consider if a dictionary lookup or set operation could replace the inner loop.' });

  // Good code ‚Äî general tips
  if (hints.length === 0) {
    const goodTips = [
      'Your code looks clean! Try the Challenges tab to test your skills with real problems. üéØ',
      'Code runs well! Consider adding <code>type hints</code> to functions: <code>def greet(name: str) -> str:</code> ‚Äî it makes code more readable.',
      'Looking good! Test your code with edge cases: empty input, negative numbers, zero, very large values.',
      'Well done! Try refactoring any repeated code into a helper function to keep things DRY (Don\'t Repeat Yourself).',
    ];
    hints.push({ type:'ok', msg: goodTips[Math.floor(Math.random() * goodTips.length)] });
  }
  return hints;
}

function explainCode() {
  const code = editor.getValue().trim();
  if (!code) { addAIMsg('sys','<div class="ai-lbl h">Explain</div>Write some code first!'); return; }

  const parts = [];
  if (code.includes('class '))     parts.push('üì¶ Defines a <strong>class</strong> ‚Äî a blueprint for creating objects (OOP).');
  if (code.includes('def '))       parts.push('‚öôÔ∏è Contains <strong>functions</strong> ‚Äî reusable named blocks of code.');
  if (code.includes('for '))       parts.push('üîÑ Uses a <strong>for loop</strong> ‚Äî iterates over a sequence of values.');
  if (code.includes('while '))     parts.push('üîÅ Uses a <strong>while loop</strong> ‚Äî repeats while a condition is True.');
  if (code.includes('if '))        parts.push('üîÄ Has <strong>conditional logic</strong> ‚Äî different code runs based on conditions.');
  if (code.includes('import '))    parts.push('üìö <strong>Imports modules</strong> ‚Äî brings in external tools and functions.');
  if (code.includes('try:'))       parts.push('üõ°Ô∏è Has <strong>exception handling</strong> ‚Äî errors are caught gracefully.');
  if (code.includes('yield'))      parts.push('üí§ Uses a <strong>generator</strong> ‚Äî produces values one at a time (lazy evaluation).');
  if (code.includes('lambda'))     parts.push('‚ö° Uses <strong>lambda</strong> ‚Äî a compact anonymous (nameless) function.');
  if (code.includes('@'))          parts.push('üé® Uses <strong>decorators</strong> ‚Äî wraps a function to add extra behavior.');
  if (/\[.*for.*in/.test(code))    parts.push('üìã Uses <strong>list comprehension</strong> ‚Äî a compact Pythonic way to build lists.');
  if (code.includes('dict') || /\{.*:/.test(code)) parts.push('üóÇÔ∏è Uses a <strong>dictionary</strong> ‚Äî stores key-value pairs.');
  if (code.includes('open('))      parts.push('üìÅ Works with <strong>files</strong> ‚Äî reads or writes data on disk.');

  const lineCount = code.split('\n').filter(l => l.trim()).length;
  parts.push(`üìè <strong>${lineCount} lines</strong> of code.`);

  const explanation = parts.length > 1
    ? parts.join('<br>')
    : 'üìù Basic Python code with variables and operations. Run it to see the output!';

  addAIMsg('hint', `<div class="ai-lbl h">üîç Code Explanation</div>${explanation}`);
}

function getAIHint() {
  const code = editor.getValue().trim();
  if (!code) {
    addAIMsg('sys','<div class="ai-lbl h">Hint</div>Write some code first, then ask for a hint!');
    return;
  }
  const results = analyzeCode(code);
  results.forEach(r => {
    addAIMsg(r.type === 'err' ? 'err' : r.type === 'ok' ? 'ok' : 'hint',
      `<div class="ai-lbl ${r.type==='err'?'e':r.type==='ok'?'o':'h'}">${r.type==='err'?'‚ö† Error Guide':r.type==='ok'?'‚úì Looks Good':'üí° Suggestion'}</div>${r.msg}`);
  });
}

function updateAIError(errMsg) {
  const results = analyzeCode(editor.getValue().trim());
  results.forEach(r => {
    addAIMsg('err', '<div class="ai-lbl e">‚ö† Error Guide</div>' + r.msg);
  });
}

function updateAISuccess() {
  const tips = [
    'Great run! Now try modifying values to see how the output changes.',
    'Code works! Can you make it more Pythonic? Try list comprehensions.',
    '‚úì Running clean! Try the Challenges tab to test your skills.',
    'Well done! Consider adding error handling with try/except blocks.',
  ];
  addAIMsg('ok', `<div class="ai-lbl o">‚úì Run Successful</div>${tips[Math.floor(Math.random()*tips.length)]}`);
}

function clearAI() {
  document.getElementById('aiBody').innerHTML = `
    <div class="ai-msg sys"><div class="ai-lbl h">Assistant</div>
    Ready to help! Run your code or click Hint for suggestions.</div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHALLENGES ‚Äî Auto-graded with Skulpt
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function checkChallenge(chal) {
  const code = editor.getValue().trim();
  if (!code) { showToast('Write your solution first!','wn'); return; }
  if (currentLang !== 'python') { showToast('Challenges require Python tab','wn'); return; }

  clearOutput();
  addLine('inf', 'üéØ Checking: "' + chal.title + '"...');
  addLine('sys', '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');

  let idx = 0, passed = 0;

  function runNext() {
    if (idx >= chal.tests.length) {
      addLine('sys', '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
      if (passed === chal.tests.length) {
        awardXP(chal.id, chal.pts, chal.title);
      } else {
        addLine('wrn', passed + '/' + chal.tests.length + ' tests passed. Keep trying! üí™');
        addAIMsg('err','<div class="ai-lbl e">Challenge Result</div>' + passed + '/' + chal.tests.length + ' tests passed. Click üí° Hint for guidance!');
      }
      return;
    }
    const test = chal.tests[idx];
    const testCode = code + '\n\nprint(repr(' + test.i + '))';
    let output = '';

    Sk.configure({
      output: t => { output += t; },
      read: x => { if (!Sk.builtinFiles?.files?.[x]) throw "File not found: '" + x + "'"; return Sk.builtinFiles.files[x]; },
      __future__: Sk.python3, execLimit: 5000,
    });

    Sk.misceval.asyncToPromise(() =>
      Sk.importMainWithBody('<stdin>', false, testCode, true)
    ).then(() => {
      const got = output.trim().split('\n').pop().trim();
      const expected = test.expected.trim();
      const ok = got === expected;
      if (ok) passed++;
      addLine(ok?'ok':'err', (ok?'‚úì ':'‚úó ') + test.i + '\n   Expected: ' + expected + '\n   Got:      ' + got);
      idx++; runNext();
    }).catch(e => {
      addLine('err', '‚úó ' + test.i + ' ‚Üí ' + e.toString().split('\n')[0]);
      idx++; runNext();
    });
  }
  runNext();
}

function awardXP(id, pts, title) {
  const isNew = !solvedChals.has(id);
  if(isNew) {
    solvedChals.add(id);
    userPoints += pts;
    updatePointsDisplay();
    saveState();
    renderChallenges();
  }
  addLine('ok', `üèÜ ALL ${isNew?'':'(already solved) '}TESTS PASSED! ${isNew?`+${pts} XP earned!`:''}`);
  if(isNew) {
    showXPBadge(pts);
    spawnConfetti();
    addAIMsg('ok', `<div class="ai-lbl o">üèÜ Challenge Solved!</div>You earned +${pts} XP for "${title}". Excellent work! Try the next challenge.`);
  }
}

function showXPBadge(pts) {
  const b = document.getElementById('xpBadge');
  b.textContent = `+${pts} XP ‚≠ê`;
  b.classList.add('show');
  setTimeout(()=>b.classList.remove('show'),3000);
}

function spawnConfetti() {
  const colors=['#e05c5c','#5b8dee','#4ecb71','#f0b429','#a78bfa','#22d3ee'];
  for(let i=0;i<50;i++){
    setTimeout(()=>{
      const el=document.createElement('div');
      el.className='cprt';
      el.style.cssText=`left:${Math.random()*100}vw;top:-10px;background:${colors[Math.floor(Math.random()*colors.length)]};width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;animation-duration:${1.5+Math.random()*1.5}s;animation-delay:${Math.random()*0.4}s;`;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),3000);
    },i*25);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LANDING ‚Üî IDE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function launchIDE(panel) {
  document.getElementById('landing').classList.add('hide');
  const ide = document.getElementById('ide');
  ide.classList.add('show');
  setTimeout(()=>{ editor.refresh(); editor.focus(); },150);
  if(panel==='tutorials'){
    setTimeout(()=>{
      const tab = document.querySelector('.stab');
      switchPanel('tutorials', tab);
    },200);
  } else if(['python','c','cpp','java'].includes(panel)){
    setTimeout(()=>switchLang(panel),150);
  }
}

function showLanding(){
  document.getElementById('ide').classList.remove('show');
  document.getElementById('landing').classList.remove('hide');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LANGUAGE SWITCH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchLang(lang) {
  currentLang = lang;
  const cfg = LANG_CFG[lang];
  editor.setOption('mode', cfg.mode);
  editor.setValue(''); // Always blank on switch
  editor.focus();
  document.getElementById('statusLang').textContent = cfg.status;
  document.querySelectorAll('.ltab').forEach(t=>t.classList.remove('active'));
  document.getElementById(`ltab-${lang}`).classList.add('active');
  // Update active tab display
  const activeTab = document.querySelector('.etab.active');
  if(activeTab){
    activeTab.querySelector('.edot').style.background = cfg.dot;
    activeTab.querySelector('.etab-name').textContent = cfg.file;
  }
  clearOutput();
  addLine('sys', `Switched to ${cfg.status}`);
  if(lang !== 'python') addLine('inf','üí° Python has live execution. C/C++/Java have syntax highlighting + tutorials.');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TUTORIALS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderTutorials(filter='') {
  const container = document.getElementById('tutList');
  container.innerHTML='';
  const groups={};
  TUTORIALS.forEach(t=>{
    if(filter && !t.title.toLowerCase().includes(filter.toLowerCase())) return;
    if(!groups[t.group]) groups[t.group]=[];
    groups[t.group].push(t);
  });
  Object.entries(groups).forEach(([grp,items])=>{
    const g=document.createElement('div');
    g.innerHTML=`<div class="tgrp-hd">${grp}</div>`;
    items.forEach(t=>{
      const done=completedTuts.has(t.id);
      const el=document.createElement('div');
      el.className=`titem${done?' done':''}`;
      el.innerHTML=`<span class="tbadge ${t.level}">${t.level==='e'?'Easy':t.level==='m'?'Med':'Hard'}</span><span class="ttitle">${t.title}</span>${done?'<span class="tdone">‚úì</span>':''}`;
      el.onclick=()=>openTutModal(t);
      g.appendChild(el);
    });
    container.appendChild(g);
  });
}

function filterTuts(v){ renderTutorials(v); }

function openTutModal(tut) {
  modalData={type:'tutorial',data:tut};
  document.getElementById('mTag').textContent=`${tut.group} ¬∑ ${tut.level==='e'?'Easy':tut.level==='m'?'Medium':'Hard'}`;
  document.getElementById('mTitle').textContent=tut.title;
  document.getElementById('mDesc').textContent=tut.desc;
  const mc=document.getElementById('mCode');
  mc.textContent=tut.code; mc.style.display='block';
  document.getElementById('mTests').innerHTML='';
  document.getElementById('mFt').innerHTML=`
    <button class="mbtn s" onclick="closeModal()">Close</button>
    <button class="mbtn p" onclick="loadTutCode()">üìã Load into Editor ‚Üí</button>`;
  document.getElementById('mainModal').classList.add('show');
}

function loadTutCode() {
  const t = modalData.data;
  switchLang(t.lang);
  editor.setValue(t.code);
  editor.focus();
  completedTuts.add(t.id);
  updateProgress(); saveState();
  closeModal();
  showToast(`"${t.title}" loaded! Press F5 to run.`,'ok');
  addAIMsg('hint',`<div class="ai-lbl h">Tutorial Loaded</div>Read the comments, then press F5. Try changing values to experiment!`);
}

function updateProgress(){
  const total=TUTORIALS.length, done=completedTuts.size;
  const pct=Math.round(done/total*100);
  document.getElementById('progTxt').textContent=`${done} / ${total}`;
  document.getElementById('progPct').textContent=pct+'%';
  document.getElementById('progFill').style.width=pct+'%';
  renderTutorials(document.getElementById('tutSearch')?.value||'');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CHALLENGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderChallenges(){
  const c=document.getElementById('chalList');
  c.innerHTML='';
  CHALLENGES.forEach(ch=>{
    const solved=solvedChals.has(ch.id);
    const el=document.createElement('div');
    el.className=`citem${solved?' solved':''}`;
    el.innerHTML=`
      <div class="citem-top">
        <span class="ctitle">${solved?'‚úì ':''} ${ch.title}</span>
        <span class="tbadge ${ch.level==='e'?'e':ch.level==='m'?'m':'h'}">${ch.pts}xp</span>
      </div>
      <div class="ctags">${ch.tags.map(t=>`<span class="ctag">${t}</span>`).join('')}</div>`;
    el.onclick=()=>openChalModal(ch);
    c.appendChild(el);
  });
}

function openChalModal(ch){
  modalData={type:'challenge',data:ch};
  document.getElementById('mTag').textContent=`Challenge ¬∑ ${ch.pts} XP ¬∑ ${ch.level==='e'?'Easy':ch.level==='m'?'Medium':'Hard'}`;
  document.getElementById('mTitle').textContent='üéØ '+ch.title;
  document.getElementById('mDesc').textContent=ch.desc;
  document.getElementById('mCode').style.display='none';
  document.getElementById('mTests').innerHTML=`
    <div style="font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:.08em;color:var(--text2);margin-bottom:.4rem">Test Cases</div>
    ${ch.tests.map(t=>`<div class="trow ${solvedChals.has(ch.id)?'pass':''}">
      <div class="trow-lbl">Input</div><code>${esc(t.i)}</code>
      <div class="trow-lbl" style="margin-top:.25rem">Expected</div><code>${esc(t.expected)}</code>
    </div>`).join('')}`;
  document.getElementById('mFt').innerHTML=`
    <button class="mbtn s" onclick="closeModal()">Close</button>
    <button class="mbtn p" onclick="loadChalStarter()">üìã Load Starter</button>
    <button class="mbtn g" onclick="closeModal();checkChallenge(modalData.data)">‚ö° Check Solution</button>`;
  document.getElementById('mainModal').classList.add('show');
}

function loadChalStarter(){
  const ch=modalData.data;
  switchLang('python');
  editor.setValue(ch.starter);
  editor.focus();
  closeModal();
  showToast('Starter loaded! Write your solution.','inf');
  addAIMsg('hint',`<div class="ai-lbl h">Challenge: ${ch.title}</div><em>Hint:</em> ${ch.hint}`);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SIDEBAR / PANELS / TABS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleSidebar(){
  sidebarOpen=!sidebarOpen;
  document.getElementById('sidebar').classList.toggle('off',!sidebarOpen);
  setTimeout(()=>editor.refresh(),280);
}
function toggleAI(){
  aiOpen=!aiOpen;
  document.getElementById('aiPanel').classList.toggle('off',!aiOpen);
  setTimeout(()=>editor.refresh(),280);
}

function switchPanel(name,el){
  document.querySelectorAll('.spanel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
  document.getElementById(`panel-${name}`).classList.add('active');
  if(el) el.classList.add('active');
}

let tabFileCount=1;
function addTab(){
  tabFileCount++;
  const cfg=LANG_CFG[currentLang];
  const name=currentLang==='java'?`File${tabFileCount}.java`:`file${tabFileCount}${cfg.ext}`;
  const bar=document.getElementById('etabsBar');
  const addBtn=bar.querySelector('.tab-add');
  const tab=document.createElement('div');
  tab.className='etab';
  tab.id=`etab-t${tabFileCount}`;
  tab.innerHTML=`<span class="edot" style="background:${cfg.dot}"></span><span class="etab-name">${name}</span><span class="etab-x" onclick="removeTab('etab-t${tabFileCount}',event)">‚úï</span>`;
  tab.onclick=()=>activateTab(tab.id);
  bar.insertBefore(tab,addBtn);
  activateTab(tab.id);
  editor.setValue('');
  editor.focus();
}

function activateTab(id){
  document.querySelectorAll('.etab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
}
function removeTab(id,e){
  e.stopPropagation();
  document.getElementById(id)?.remove();
  document.getElementById('etab-0')?.classList.add('active');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   OUTPUT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchOTab(tab,el){
  document.querySelectorAll('.otab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('stdinRow').style.display=tab==='input'?'flex':'none';
  if(tab==='history') showHistory();
}
function showHistory(){
  clearOutput();
  if(!runHistory.length){addLine('sys','No history yet.');return;}
  addLine('inf',`Last ${runHistory.length} runs:`);
  runHistory.forEach((r,i)=>addLine('sys',`[${r.time}] Run #${runHistory.length-i} ‚Äî ${r.code.split('\n').length} lines`));
}
function cycleOutput(){
  outputSize=(outputSize+1)%3;
  const p=document.getElementById('outPanel');
  p.classList.remove('lg','sm');
  if(outputSize===1)p.classList.add('lg');
  if(outputSize===2)p.classList.add('sm');
  document.getElementById('resizeBtn').textContent=['‚¨Ü','‚¨á','‚Üï'][outputSize];
  setTimeout(()=>editor.refresh(),280);
}
function handleStdin(e){
  if(e.key==='Enter'){
    const v=document.getElementById('stdinInp').value;
    if(v){addLine('inf','> '+v);document.getElementById('stdinInp').value='';}
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SETTINGS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toggleSetting(key,el){
  settings[key]=!settings[key];
  el.classList.toggle('on',settings[key]);
  if(key==='lineNumbers') editor.setOption('lineNumbers',settings[key]);
  if(key==='brackets') editor.setOption('autoCloseBrackets',settings[key]);
  if(key==='activeLine') editor.setOption('styleActiveLine',settings[key]);
  if(key==='folding'){
    editor.setOption('foldGutter',settings[key]);
    editor.setOption('gutters',settings[key]?['CodeMirror-linenumbers','CodeMirror-foldgutter']:['CodeMirror-linenumbers']);
  }
}
function setTabSize(v){ editor.setOption('tabSize',+v); editor.setOption('indentUnit',+v); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   THEME / APPEARANCE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function changeTheme(theme){
  currentTheme=theme;
  editor.setOption('theme',isLightMode?'default':theme);
  saveState();
}
function toggleLightMode(){
  isLightMode=!isLightMode;
  document.body.classList.toggle('light-mode',isLightMode);
  editor.setOption('theme',isLightMode?'default':currentTheme);
}
function changeFontSize(d){
  fontSize=Math.min(Math.max(fontSize+d,10),26);
  editor.getWrapperElement().style.fontSize=fontSize+'px';
  document.getElementById('fszDisplay').textContent=fontSize;
  editor.refresh();
  saveState();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UTILITIES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function copyCode(){
  const code=editor.getValue();
  if(!code){showToast('Nothing to copy!','wn');return;}
  navigator.clipboard.writeText(code).then(()=>showToast('Code copied!','ok')).catch(()=>showToast('Copy failed','er'));
}
function downloadCode(){
  const code=editor.getValue();
  if(!code){showToast('Nothing to download!','wn');return;}
  const ext=LANG_CFG[currentLang].ext;
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([code],{type:'text/plain'}));
  a.download=`code${ext}`;
  a.click();
  showToast(`Downloaded as code${ext}`,'ok');
}
function saveCode(){
  saveState();
  document.getElementById('saveDot').classList.remove('dirty');
}
function saveNotes(){
  notes=document.getElementById('notesTA').value;
  saveState();
  showToast('Notes saved!','ok');
}
function saveState(){
  try{
    localStorage.setItem('cp_v2',JSON.stringify({
      pts:userPoints,tuts:[...completedTuts],chals:[...solvedChals],
      notes,fsz:fontSize,theme:currentTheme,
    }));
  }catch(e){}
}
function updatePointsDisplay(){
  document.getElementById('ptsChip').textContent=`‚≠ê ${userPoints} XP`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COLLAB
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function createRoom(){
  const id=document.getElementById('roomInp').value||`room-${Math.floor(Math.random()*9000)+1000}`;
  document.getElementById('roomInp').value=id;
  showToast(`Room "${id}" created!`,'ok');
  addFakeUsers();
}
function joinRoom(){
  const id=document.getElementById('roomInp').value;
  if(!id){showToast('Enter a Room ID first','wn');return;}
  showToast(`Joining "${id}"...`,'inf');
  addFakeUsers();
}
function addFakeUsers(){
  const names=['Priya S.','Rahul K.','Sneha M.'];
  const ul=document.getElementById('ulist');
  ul.innerHTML=`<div class="upill"><div class="udot"></div><span>You</span><span class="uyou">YOU</span></div>`;
  names.slice(0,2).forEach(n=>{
    const p=document.createElement('div');
    p.className='upill';
    p.innerHTML=`<div class="udot" style="background:var(--blue)"></div><span>${n}</span>`;
    ul.appendChild(p);
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODALS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function closeModal(){ document.getElementById('mainModal').classList.remove('show'); }
function showShortcuts(){ document.getElementById('scModal').classList.add('show'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showToast(msg,type='inf'){
  const t=document.getElementById('toast');
  t.textContent=({'ok':'‚úì','er':'‚úó','inf':'‚Ñπ','wn':'‚ö†'}[type]||'')+' '+msg;
  t.className=`toast ${type} show`;
  clearTimeout(t._t);
  t._t=setTimeout(()=>t.classList.remove('show'),3000);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GLOBAL KEYS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){ closeModal(); document.getElementById('scModal').classList.remove('show'); }
});
document.getElementById('mainModal').addEventListener('click',e=>{ if(e.target.id==='mainModal') closeModal(); });
document.getElementById('scModal').addEventListener('click',e=>{ if(e.target.id==='scModal') document.getElementById('scModal').classList.remove('show'); });

// Notes auto-save
document.getElementById('notesTA').addEventListener('input',e=>{
  notes=e.target.value;
  clearTimeout(window._nt);
  window._nt=setTimeout(saveState,1000);
});
</script>
</body>
</html>
